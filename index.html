<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Widerstandsnetzwerke â€“ Interaktiver Workshop</title>
<style>
:root {
  --bg: #0d1b0e; --bg2: #142116; --bg3: #1a2e1c;
  --fg: #e8f0e8; --fg2: #a8c4a8; --accent: #4caf50;
  --accent2: #81c784; --err: #ef5350; --ok: #66bb6a;
  --warn: #ffa726; --radius: 8px; --shadow: 0 2px 8px #0004;
}
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family: 'Segoe UI', system-ui, sans-serif; background:var(--bg); color:var(--fg); min-height:100vh; display:flex; font-size:18px; line-height:1.6; }
/* NAV */
nav { width:260px; min-height:100vh; background:var(--bg2); border-right:2px solid var(--accent); padding:1rem 0; position:fixed; top:0; left:0; z-index:100; display:flex; flex-direction:column; transition:transform .3s; }
nav.closed { transform:translateX(-260px); }
.nav-toggle { display:none; position:fixed; top:.5rem; left:.5rem; z-index:200; background:var(--accent); color:#fff; border:none; border-radius:var(--radius); width:44px; height:44px; font-size:1.5rem; cursor:pointer; }
nav h1 { font-size:1.1rem; padding:.5rem 1rem; color:var(--accent2); border-bottom:1px solid var(--bg3); margin-bottom:.5rem; }
nav a { display:block; padding:.6rem 1rem; color:var(--fg2); text-decoration:none; font-size:.95rem; border-left:3px solid transparent; transition:all .2s; }
nav a:hover, nav a.active { background:var(--bg3); color:var(--accent2); border-left-color:var(--accent); }
nav a .ch-num { display:inline-block; width:1.8em; font-weight:700; color:var(--accent); }
nav a .ch-check { float:right; opacity:0; transition:opacity .2s; }
nav a .ch-check.done { opacity:1; }
.progress-wrap { margin-top:auto; padding:.8rem 1rem; }
.progress-bar { height:6px; background:var(--bg); border-radius:3px; overflow:hidden; }
.progress-fill { height:100%; background:var(--accent); width:0%; transition:width .5s; }
.progress-label { font-size:.75rem; color:var(--fg2); margin-top:.3rem; text-align:center; }
/* MAIN */
main { margin-left:260px; flex:1; padding:2rem; max-width:960px; }
section { display:none; }
section.active { display:block; animation: fadeIn .3s; }
@keyframes fadeIn { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:none} }
h2 { color:var(--accent2); font-size:1.6rem; margin-bottom:1rem; border-bottom:2px solid var(--accent); padding-bottom:.4rem; }
h3 { color:var(--accent); margin:1.2rem 0 .5rem; font-size:1.15rem; }
p, li { margin-bottom:.5rem; }
ul { padding-left:1.5rem; }
/* COMPONENTS */
.theory { background:var(--bg3); border-left:4px solid var(--accent); padding:1rem 1.2rem; border-radius:0 var(--radius) var(--radius) 0; margin:1rem 0; }
.theory .formula { font-size:1.3rem; text-align:center; padding:.5rem; color:var(--accent2); font-weight:600; }
.warn-box { background:#2a1a00; border-left:4px solid var(--warn); padding:1rem 1.2rem; border-radius:0 var(--radius) var(--radius) 0; margin:1rem 0; color:#ffe0b2; }
.input-group { display:flex; flex-wrap:wrap; gap:.8rem; align-items:center; margin:.8rem 0; }
.input-group label { min-width:80px; font-weight:600; color:var(--fg2); }
.input-group input[type=number], .input-group input[type=text] { width:100px; padding:.4rem .6rem; background:var(--bg); border:1px solid var(--fg2); color:var(--fg); border-radius:var(--radius); font-size:1rem; text-align:right; }
.input-group input:focus { border-color:var(--accent); outline:none; }
.input-group .unit { color:var(--fg2); font-size:.9rem; margin-left:-.4rem; }
.slider-group { display:flex; align-items:center; gap:.6rem; margin:.4rem 0; flex-wrap:wrap; }
.slider-group label { min-width:60px; font-weight:600; color:var(--fg2); }
.slider-group input[type=range] { flex:1; min-width:120px; accent-color:var(--accent); }
.slider-group .val { min-width:70px; text-align:right; font-family:monospace; color:var(--accent2); }
button { padding:.5rem 1.2rem; background:var(--accent); color:#fff; border:none; border-radius:var(--radius); cursor:pointer; font-size:1rem; font-weight:600; transition:background .2s; }
button:hover { background:var(--accent2); color:var(--bg); }
button.secondary { background:var(--bg3); color:var(--fg2); border:1px solid var(--fg2); }
button.secondary:hover { border-color:var(--accent); color:var(--accent); }
.result { margin:1rem 0; padding:.8rem 1rem; border-radius:var(--radius); font-family:monospace; font-size:1rem; display:none; }
.result.show { display:block; }
.result.ok { background:#1b3a1b; border:1px solid var(--ok); color:var(--ok); }
.result.err { background:#3a1b1b; border:1px solid var(--err); color:var(--err); }
.result.info { background:var(--bg3); border:1px solid var(--fg2); color:var(--fg); }
.result-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(200px,1fr)); gap:.5rem; }
.result-grid .item { background:var(--bg2); padding:.5rem .8rem; border-radius:var(--radius); }
.result-grid .item .lbl { font-size:.8rem; color:var(--fg2); }
.result-grid .item .val { font-size:1.1rem; color:var(--accent2); font-family:monospace; }
/* SVG */
svg.circuit { width:100%; max-width:500px; display:block; margin:1rem auto; }
svg.circuit text { fill:var(--fg); font-family:'Segoe UI',system-ui,sans-serif; font-size:14px; }
svg.circuit .wire { stroke:var(--fg2); stroke-width:2; fill:none; }
svg.circuit .resistor { stroke:var(--accent2); stroke-width:2.5; fill:none; }
svg.circuit .source { stroke:var(--warn); stroke-width:2.5; fill:none; }
svg.circuit .node-dot { fill:var(--accent); }
svg.circuit .arrow { fill:var(--accent); stroke:none; }
svg.circuit .current-dot { fill:var(--warn); }
/* flow animation */
@keyframes flowRight { from{stroke-dashoffset:20} to{stroke-dashoffset:0} }
@keyframes flowLeft { from{stroke-dashoffset:-20} to{stroke-dashoffset:0} }
svg.circuit .flow { stroke-dasharray:4 16; stroke-width:3; stroke:var(--warn); opacity:.6; animation: flowRight 1s linear infinite; }
/* TABLES */
table.eq-table { border-collapse:collapse; margin:.8rem 0; width:100%; }
table.eq-table th, table.eq-table td { border:1px solid var(--bg3); padding:.4rem .6rem; text-align:center; }
table.eq-table th { background:var(--bg3); color:var(--accent2); font-weight:600; }
table.eq-table input { width:70px; padding:.3rem; background:var(--bg); border:1px solid var(--fg2); color:var(--fg); border-radius:4px; text-align:center; font-size:.95rem; }
table.eq-table input:focus { border-color:var(--accent); outline:none; }
table.eq-table input.ok { border-color:var(--ok); background:#1b3a1b; }
table.eq-table input.err { border-color:var(--err); background:#3a1b1b; }
/* interactive step */
.step-box { background:var(--bg2); border:1px solid var(--bg3); border-radius:var(--radius); padding:1rem; margin:.8rem 0; }
.step-box.current { border-color:var(--accent); }
.step-box h4 { color:var(--accent); margin-bottom:.4rem; }
.choice-btns { display:flex; flex-wrap:wrap; gap:.5rem; margin:.5rem 0; }
.choice-btns button { font-size:.9rem; padding:.4rem .8rem; }
.choice-btns button.selected { background:var(--accent2); color:var(--bg); }
/* highlight for SVG interactive */
.highlight { stroke:var(--warn)!important; stroke-width:3.5!important; }
.highlight-fill { fill:var(--warn)!important; opacity:.3; }
/* CAS box */
.cas-box { background:#1a1a2e; border:1px solid #5c6bc0; border-radius:var(--radius); padding:.8rem 1rem; margin:.8rem 0; font-family:monospace; color:#9fa8da; white-space:pre-wrap; font-size:.9rem; }
.cas-box .cas-label { color:#5c6bc0; font-weight:700; font-family:sans-serif; font-size:.8rem; margin-bottom:.3rem; }
/* RESPONSIVE */
@media(max-width:800px){
  nav { transform:translateX(-260px); }
  nav.open { transform:translateX(0); }
  .nav-toggle { display:block; }
  main { margin-left:0; padding:1rem; }
}
/* Kirchhoff node/mesh selector */
.node-sel, .mesh-sel { display:inline-block; padding:.3rem .7rem; margin:.2rem; border:2px solid var(--fg2); border-radius:var(--radius); cursor:pointer; transition:all .2s; }
.node-sel:hover, .mesh-sel:hover { border-color:var(--accent); }
.node-sel.active, .mesh-sel.active { border-color:var(--accent); background:var(--accent); color:#fff; }
/* Equation input row */
.eq-row { display:flex; align-items:center; gap:.4rem; margin:.5rem 0; flex-wrap:wrap; font-family:monospace; font-size:1.05rem; }
.eq-row input { width:60px; }
.eq-row span { color:var(--fg2); }
</style>
</head>
<body>
<button class="nav-toggle" onclick="document.querySelector('nav').classList.toggle('open')" aria-label="MenÃ¼">â˜°</button>
<nav id="nav">
  <h1>âš¡ Kirchhoff-Workshop</h1>
  <a href="#" data-ch="0" class="active"><span class="ch-num">1</span> Parallelschaltung <span class="ch-check">âœ“</span></a>
  <a href="#" data-ch="1"><span class="ch-num">2</span> Gemischte Schaltung <span class="ch-check">âœ“</span></a>
  <a href="#" data-ch="2"><span class="ch-num">3</span> Wheatstone-BrÃ¼cke <span class="ch-check">âœ“</span></a>
  <a href="#" data-ch="3"><span class="ch-num">4</span> Kirchhoff'sche Regeln <span class="ch-check">âœ“</span></a>
  <a href="#" data-ch="4"><span class="ch-num">5</span> Gleichungssystem <span class="ch-check">âœ“</span></a>
  <a href="#" data-ch="5"><span class="ch-num">6</span> Freier Rechner <span class="ch-check">âœ“</span></a>
  <div class="progress-wrap">
    <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
    <div class="progress-label" id="progressLabel">0 / 6 abgeschlossen</div>
  </div>
</nav>

<main>
<!-- ===== KAPITEL 1: PARALLELSCHALTUNG ===== -->
<section id="ch0" class="active">
<h2>1 Â· Parallelschaltung</h2>
<div class="theory">
  <h3>Formel</h3>
  <div class="formula">1/R<sub>ges</sub> = 1/Râ‚ + 1/Râ‚‚ + 1/Râ‚ƒ</div>
  <p>Bei der Parallelschaltung liegt an allen WiderstÃ¤nden die <strong>gleiche Spannung</strong> an. Die StrÃ¶me teilen sich auf.</p>
</div>

<svg class="circuit" viewBox="0 0 440 220" id="svg-parallel">
  <!-- Wires -->
  <line x1="30" y1="110" x2="100" y2="110" class="wire"/>
  <line x1="100" y1="40" x2="100" y2="180" class="wire"/>
  <line x1="340" y1="40" x2="340" y2="180" class="wire"/>
  <line x1="340" y1="110" x2="410" y2="110" class="wire"/>
  <!-- R1 -->
  <line x1="100" y1="40" x2="160" y2="40" class="wire"/>
  <line x1="160.0" y1="40.0" x2="180.0" y2="40.0" class="wire"/><line x1="240.0" y1="40.0" x2="260.0" y2="40.0" class="wire"/><polygon points="180.0,48.0 240.0,48.0 240.0,32.0 180.0,32.0" fill="none" stroke="var(--accent2)" stroke-width="2.5"/>
  <line x1="260" y1="40" x2="340" y2="40" class="wire"/>
  <text x="210" y="18" text-anchor="middle" id="par-r1-label">Râ‚ = 100 Î©</text>
  <!-- R2 -->
  <line x1="100" y1="110" x2="160" y2="110" class="wire"/>
  <line x1="160.0" y1="110.0" x2="180.0" y2="110.0" class="wire"/><line x1="240.0" y1="110.0" x2="260.0" y2="110.0" class="wire"/><polygon points="180.0,118.0 240.0,118.0 240.0,102.0 180.0,102.0" fill="none" stroke="var(--accent2)" stroke-width="2.5"/>
  <line x1="260" y1="110" x2="340" y2="110" class="wire"/>
  <text x="210" y="145" text-anchor="middle" id="par-r2-label">Râ‚‚ = 220 Î©</text>
  <!-- R3 -->
  <line x1="100" y1="180" x2="160" y2="180" class="wire"/>
  <line x1="160.0" y1="180.0" x2="180.0" y2="180.0" class="wire"/><line x1="240.0" y1="180.0" x2="260.0" y2="180.0" class="wire"/><polygon points="180.0,188.0 240.0,188.0 240.0,172.0 180.0,172.0" fill="none" stroke="var(--accent2)" stroke-width="2.5"/>
  <line x1="260" y1="180" x2="340" y2="180" class="wire"/>
  <text x="210" y="210" text-anchor="middle" id="par-r3-label">Râ‚ƒ = 330 Î©</text>
  <!-- Flow lines -->
  <line x1="100" y1="40" x2="340" y2="40" class="flow" style="opacity:0" id="par-flow1"/>
  <line x1="100" y1="110" x2="340" y2="110" class="flow" style="opacity:0" id="par-flow2"/>
  <line x1="100" y1="180" x2="340" y2="180" class="flow" style="opacity:0" id="par-flow3"/>
  <!-- Nodes -->
  <circle cx="100" cy="110" r="5" class="node-dot"/>
  <circle cx="340" cy="110" r="5" class="node-dot"/>
  <text x="20" y="115" text-anchor="middle" fill="#ffa726" font-weight="700">+</text>
  <text x="420" y="115" text-anchor="middle" fill="#ffa726" font-weight="700">âˆ’</text>
</svg>

<h3>Werte einstellen</h3>
<div class="slider-group">
  <label>Râ‚:</label>
  <input type="range" min="10" max="1000" value="100" step="10" id="par-r1" oninput="parCalc()">
  <span class="val" id="par-r1-val">100 Î©</span>
</div>
<div class="slider-group">
  <label>Râ‚‚:</label>
  <input type="range" min="10" max="1000" value="220" step="10" id="par-r2" oninput="parCalc()">
  <span class="val" id="par-r2-val">220 Î©</span>
</div>
<div class="slider-group">
  <label>Râ‚ƒ:</label>
  <input type="range" min="10" max="1000" value="330" step="10" id="par-r3" oninput="parCalc()">
  <span class="val" id="par-r3-val">330 Î©</span>
</div>
<div class="slider-group">
  <label>U:</label>
  <input type="range" min="1" max="30" value="12" step="0.5" id="par-u" oninput="parCalc()">
  <span class="val" id="par-u-val">12 V</span>
</div>

<div class="result info show" id="par-result">
  <div class="result-grid" id="par-result-grid"></div>
</div>

<h3>Ãœbungsaufgabe</h3>
<p>Râ‚ = 150 Î©, Râ‚‚ = 300 Î© parallel. Wie groÃŸ ist R<sub>ges</sub>?</p>
<div class="input-group">
  <label>R<sub>ges</sub> =</label>
  <input type="number" id="par-quiz" step="1">
  <span class="unit">Î©</span>
  <button onclick="parCheck()">PrÃ¼fen</button>
</div>
<div class="result" id="par-quiz-result"></div>
</section>

<!-- ===== KAPITEL 2: GEMISCHTE SCHALTUNG ===== -->
<section id="ch1">
<h2>2 Â· Gemischte Schaltungen</h2>
<div class="theory">
  <p>Gemischte Schaltungen enthalten sowohl <strong>Reihen-</strong> als auch <strong>Parallelschaltungen</strong>. Man vereinfacht schrittweise von innen nach auÃŸen.</p>
</div>

<svg class="circuit" viewBox="0 0 480 200" id="svg-mixed">
  <!-- Source -->
  <line x1="30" y1="100" x2="80" y2="100" class="wire"/>
  <!-- R1 in series -->
  <line x1="80.0" y1="100.0" x2="96.0" y2="100.0" class="wire"/><line x1="144.0" y1="100.0" x2="160.0" y2="100.0" class="wire"/><polygon points="96.0,108.0 144.0,108.0 144.0,92.0 96.0,92.0" fill="none" stroke="var(--accent2)" stroke-width="2.5"/>
  <text x="120" y="75" text-anchor="middle" id="mix-r1-text">Râ‚ = 100 Î©</text>
  <line x1="160" y1="100" x2="200" y2="100" class="wire"/>
  <!-- Split -->
  <line x1="200" y1="50" x2="200" y2="150" class="wire"/>
  <!-- R2 top -->
  <line x1="200" y1="50" x2="240" y2="50" class="wire"/>
  <line x1="240.0" y1="50.0" x2="256.0" y2="50.0" class="wire"/><line x1="304.0" y1="50.0" x2="320.0" y2="50.0" class="wire"/><polygon points="256.0,58.0 304.0,58.0 304.0,42.0 256.0,42.0" fill="none" stroke="var(--accent2)" stroke-width="2.5"/>
  <line x1="320" y1="50" x2="380" y2="50" class="wire"/>
  <text x="280" y="30" text-anchor="middle" id="mix-r2-text">Râ‚‚ = 220 Î©</text>
  <!-- R3 bottom -->
  <line x1="200" y1="150" x2="240" y2="150" class="wire"/>
  <line x1="240.0" y1="150.0" x2="256.0" y2="150.0" class="wire"/><line x1="304.0" y1="150.0" x2="320.0" y2="150.0" class="wire"/><polygon points="256.0,158.0 304.0,158.0 304.0,142.0 256.0,142.0" fill="none" stroke="var(--accent2)" stroke-width="2.5"/>
  <line x1="320" y1="150" x2="380" y2="150" class="wire"/>
  <text x="280" y="175" text-anchor="middle" id="mix-r3-text">Râ‚ƒ = 330 Î©</text>
  <!-- Merge -->
  <line x1="380" y1="50" x2="380" y2="150" class="wire"/>
  <line x1="380" y1="100" x2="450" y2="100" class="wire"/>
  <!-- Nodes -->
  <circle cx="200" cy="100" r="5" class="node-dot"/>
  <circle cx="380" cy="100" r="5" class="node-dot"/>
</svg>

<h3>Schritt-fÃ¼r-Schritt Vereinfachung</h3>
<div class="step-box current" id="mix-step1">
  <h4>Schritt 1: Welche WiderstÃ¤nde liegen parallel?</h4>
  <div class="choice-btns">
    <button onclick="mixChoice(1,'r1r2')">Râ‚ âˆ¥ Râ‚‚</button>
    <button onclick="mixChoice(1,'r2r3')">Râ‚‚ âˆ¥ Râ‚ƒ</button>
    <button onclick="mixChoice(1,'r1r3')">Râ‚ âˆ¥ Râ‚ƒ</button>
  </div>
  <div class="result" id="mix-step1-result"></div>
</div>
<div class="step-box" id="mix-step2" style="opacity:.4">
  <h4>Schritt 2: Berechne Râ‚‚â‚ƒ = Râ‚‚ âˆ¥ Râ‚ƒ</h4>
  <div class="input-group">
    <label>Râ‚‚â‚ƒ =</label>
    <input type="number" id="mix-r23" step="0.1">
    <span class="unit">Î©</span>
    <button onclick="mixCheck2()">PrÃ¼fen</button>
  </div>
  <div class="result" id="mix-step2-result"></div>
</div>
<div class="step-box" id="mix-step3" style="opacity:.4">
  <h4>Schritt 3: R<sub>ges</sub> = Râ‚ + Râ‚‚â‚ƒ (Reihenschaltung)</h4>
  <div class="input-group">
    <label>R<sub>ges</sub> =</label>
    <input type="number" id="mix-rges" step="0.1">
    <span class="unit">Î©</span>
    <button onclick="mixCheck3()">PrÃ¼fen</button>
  </div>
  <div class="result" id="mix-step3-result"></div>
</div>
</section>

<!-- ===== KAPITEL 3: WHEATSTONE-BRÃœCKE ===== -->
<section id="ch2">
<h2>3 Â· Wheatstone-BrÃ¼cke</h2>
<div class="theory">
  <p>Die Wheatstone-BrÃ¼cke besteht aus <strong>vier WiderstÃ¤nden</strong> in einer BrÃ¼cken-(Diamant-)Anordnung und einem <strong>BrÃ¼ckenwiderstand Râ‚…</strong> zwischen den Mittelpunkten.</p>
  <div class="formula">Diese Schaltung lÃ¤sst sich <strong>NICHT</strong> durch Reihen-/Parallelschaltung vereinfachen!</div>
</div>

<svg class="circuit" viewBox="-90 0 500 360" id="svg-wheatstone">
  <defs><marker id="arw" viewBox="0 0 10 10" refX="10" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="#ffa726"/></marker></defs>
  <!-- R1: A to B -->
  <line x1="200" y1="30" x2="155" y2="77" class="wire"/>
  <polygon points="147,70 98,121 113,135 162,84" fill="none" stroke="var(--accent2)" stroke-width="2.5"/>
  <line x1="106" y1="128" x2="60" y2="175" class="wire"/>
  <text x="108" y="84" text-anchor="end" fill="#81c784" font-weight="600" font-size="15">Râ‚</text>
  <line x1="172" y1="59" x2="164" y2="68" stroke="#ffa726" stroke-width="2" marker-end="url(#arw)"/>
  <text x="145" y="52" text-anchor="end" fill="#ffa726" font-size="12">Iâ‚</text>
  <!-- R2: A to C -->
  <line x1="200" y1="30" x2="246" y2="77" class="wire"/>
  <polygon points="238,84 288,135 302,121 253,70" fill="none" stroke="var(--accent2)" stroke-width="2.5"/>
  <line x1="295" y1="128" x2="340" y2="175" class="wire"/>
  <text x="292" y="84" text-anchor="start" fill="#81c784" font-weight="600" font-size="15">Râ‚‚</text>
  <line x1="228" y1="59" x2="236" y2="68" stroke="#ffa726" stroke-width="2" marker-end="url(#arw)"/>
  <text x="255" y="52" text-anchor="start" fill="#ffa726" font-size="12">Iâ‚‚</text>
  <!-- R3: B to D -->
  <line x1="60" y1="175" x2="106" y2="222" class="wire"/>
  <polygon points="98,229 147,280 162,266 113,215" fill="none" stroke="var(--accent2)" stroke-width="2.5"/>
  <line x1="155" y1="273" x2="200" y2="320" class="wire"/>
  <text x="108" y="266" text-anchor="end" fill="#81c784" font-weight="600" font-size="15">Râ‚ƒ</text>
  <line x1="88" y1="204" x2="96" y2="213" stroke="#ffa726" stroke-width="2" marker-end="url(#arw)"/>
  <text x="62" y="210" text-anchor="end" fill="#ffa726" font-size="12">Iâ‚ƒ</text>
  <!-- R4: C to D -->
  <line x1="340" y1="175" x2="295" y2="222" class="wire"/>
  <polygon points="287,215 238,266 253,280 302,229" fill="none" stroke="var(--accent2)" stroke-width="2.5"/>
  <line x1="246" y1="273" x2="200" y2="320" class="wire"/>
  <text x="292" y="266" text-anchor="start" fill="#81c784" font-weight="600" font-size="15">Râ‚„</text>
  <line x1="312" y1="204" x2="304" y2="213" stroke="#ffa726" stroke-width="2" marker-end="url(#arw)"/>
  <text x="338" y="210" text-anchor="start" fill="#ffa726" font-size="12">Iâ‚„</text>
  <!-- R5: B to C (bridge) -->
  <line x1="60" y1="175" x2="151" y2="175" class="wire"/>
  <rect x="151" y="165" width="98" height="20" fill="none" stroke="var(--warn)" stroke-width="2.5"/>
  <line x1="249" y1="175" x2="340" y2="175" class="wire"/>
  <text x="200" y="158" text-anchor="middle" fill="#ffa726" font-weight="700" font-size="15">Râ‚…</text>
  <line x1="108" y1="175" x2="120" y2="175" stroke="#ffa726" stroke-width="2" marker-end="url(#arw)"/>
  <text x="100" y="168" text-anchor="end" fill="#ffa726" font-size="12">Iâ‚…</text>
  <!-- Spannungsquelle Uâ‚€: A links runter nach D -->
  <line x1="200" y1="30" x2="-30" y2="30" class="wire"/>
  <line x1="-30" y1="30" x2="-30" y2="150" class="wire"/>
  <circle cx="-30" cy="175" r="25" fill="none" stroke="var(--accent2)" stroke-width="2"/>
  <line x1="-30" y1="150" x2="-30" y2="200" stroke="var(--accent2)" stroke-width="2"/>
  <text x="-2" y="160" text-anchor="start" fill="#ffa726" font-size="14" font-weight="700">+</text>
  <text x="-2" y="198" text-anchor="start" fill="#ffa726" font-size="14" font-weight="700">âˆ’</text>
  <text x="-62" y="180" text-anchor="end" fill="#ffa726" font-size="13" font-weight="600">Uâ‚€</text>
  <line x1="-30" y1="200" x2="-30" y2="320" class="wire"/>
  <line x1="-30" y1="320" x2="200" y2="320" class="wire"/>
  <!-- Nodes -->
  <circle cx="200" cy="30" r="5" class="node-dot"/>
  <text x="200" y="15" text-anchor="middle" fill="#4caf50" font-weight="700" font-size="16">A</text>
  <circle cx="60" cy="175" r="5" class="node-dot"/>
  <text x="38" y="180" text-anchor="end" fill="#4caf50" font-weight="700" font-size="16">B</text>
  <circle cx="340" cy="175" r="5" class="node-dot"/>
  <text x="362" y="180" text-anchor="start" fill="#4caf50" font-weight="700" font-size="16">C</text>
  <circle cx="200" cy="320" r="5" class="node-dot"/>
  <text x="200" y="342" text-anchor="middle" fill="#4caf50" font-weight="700" font-size="16">D</text>
</svg>

<h3>Warum geht Reihe/Parallel nicht?</h3>
<ul>
  <li>Râ‚ und Râ‚ƒ liegen <strong>nicht einfach in Reihe</strong>, weil am Knoten B ein Strom Ã¼ber Râ‚… abflieÃŸt.</li>
  <li>Râ‚ und Râ‚‚ liegen <strong>nicht parallel</strong>, weil sie verschiedene Endknoten haben (B vs. C).</li>
  <li>Der BrÃ¼ckenwiderstand Râ‚… verbindet die beiden Zweige â†’ <strong>keine einfache Zerlegung mÃ¶glich</strong>.</li>
</ul>

<h3>Abgeglichene BrÃ¼cke</h3>
<div class="theory">
  <div class="formula">Râ‚ Â· Râ‚„ = Râ‚‚ Â· Râ‚ƒ âŸ¹ Iâ‚… = 0, U<sub>BC</sub> = 0</div>
  <p>Wenn die BrÃ¼cke <strong>abgeglichen</strong> ist, flieÃŸt kein Strom durch Râ‚…. Dann darf man Reihen-/Parallel-Vereinfachung nutzen:</p>
  <div class="formula">R<sub>ges</sub> = (Râ‚+Râ‚ƒ) âˆ¥ (Râ‚‚+Râ‚„)</div>
</div>

<h3>Ist unsere BrÃ¼cke abgeglichen?</h3>
<div class="input-group">
  <span>Râ‚Â·Râ‚„ = 100Â·470 = <strong>47.000</strong></span>
</div>
<div class="input-group">
  <span>Râ‚‚Â·Râ‚ƒ = 220Â·330 = <strong>72.600</strong></span>
</div>
<div class="result info show">47.000 â‰  72.600 â†’ Die BrÃ¼cke ist <strong>nicht abgeglichen</strong>. Wir brauchen Kirchhoff!</div>

<h3>Quiz</h3>
<p>Wann ist eine Wheatstone-BrÃ¼cke abgeglichen?</p>
<div class="choice-btns">
  <button onclick="wheatQuiz(this,false)">Râ‚ + Râ‚„ = Râ‚‚ + Râ‚ƒ</button>
  <button onclick="wheatQuiz(this,true)">Râ‚ Â· Râ‚„ = Râ‚‚ Â· Râ‚ƒ</button>
  <button onclick="wheatQuiz(this,false)">Râ‚ = Râ‚‚ = Râ‚ƒ = Râ‚„</button>
</div>
<div class="result" id="wheat-quiz-result"></div>
</section>

<!-- ===== KAPITEL 4: KIRCHHOFF ===== -->
<section id="ch3">
<h2>4 Â· Kirchhoff'sche Regeln</h2>

<div class="theory">
  <h3>1. Knotenregel (KCL)</h3>
  <div class="formula">âˆ‘ I<sub>zu</sub> = âˆ‘ I<sub>ab</sub> &nbsp;(bzw. âˆ‘ I = 0 mit Vorzeichen)</div>
  <h3 style="margin-top:.8rem">2. Maschenregel (KVL)</h3>
  <div class="formula">âˆ‘ U = 0 &nbsp;(Umlauf in einer geschlossenen Masche)</div>
  <p style="margin-top:.8rem">In einer geschlossenen Masche ist die Summe aller Spannungen gleich Null. Dazu legt man eine <strong>Umlaufrichtung</strong> fest (z.B. im Uhrzeigersinn) und geht die Masche Schritt fÃ¼r Schritt ab:</p>
  
  <h3 style="margin-top:.8rem">Vorzeichen der Spannung an einem Widerstand</h3>
  <p>An jedem Widerstand fÃ¤llt eine Spannung <em>U = R Â· I</em> ab. Die Richtung des Spannungsabfalls ist <strong>immer gleich</strong> der festgelegten Stromrichtung (von + nach âˆ’).</p>
  <ul>
    <li>Gehst du <strong>in Stromrichtung</strong> durch den Widerstand â†’ du gehst von + nach âˆ’<br>â†’ die Spannung wird <strong>abgezogen</strong> (Spannungsabfall): <strong>âˆ’RÂ·I</strong></li>
    <li>Gehst du <strong>gegen die Stromrichtung</strong> â†’ du gehst von âˆ’ nach +<br>â†’ die Spannung wird <strong>addiert</strong> (Spannungsanstieg): <strong>+RÂ·I</strong></li>
  </ul>
  
  <h3 style="margin-top:.8rem">Vorzeichen der Spannungsquelle</h3>
  <p>Bei einer Spannungsquelle ist die PolaritÃ¤t fest (+ und âˆ’ Pol):</p>
  <ul>
    <li>Gehst du im Umlauf <strong>von âˆ’ nach +</strong> (durch die Quelle â€aufwÃ¤rts")<br>â†’ Spannungsanstieg: <strong>+Uâ‚€</strong></li>
    <li>Gehst du im Umlauf <strong>von + nach âˆ’</strong> (durch die Quelle â€abwÃ¤rts")<br>â†’ Spannungsabfall: <strong>âˆ’Uâ‚€</strong></li>
  </ul>

  <h3 style="margin-top:.8rem">Einfaches Beispiel: Eine Masche mit Quelle und zwei WiderstÃ¤nden</h3>
  
  <svg viewBox="0 0 400 220" style="max-width:400px;margin:1rem auto;display:block">
    <defs><marker id="arw-ex" viewBox="0 0 10 10" refX="10" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="#ffa726"/></marker></defs>
    <!-- DrÃ¤hte oben: LÃ¼cke fÃ¼r R1 -->
    <line x1="50" y1="30" x2="150" y2="30" stroke="var(--accent2)" stroke-width="2"/>
    <line x1="230" y1="30" x2="350" y2="30" stroke="var(--accent2)" stroke-width="2"/>
    <!-- DrÃ¤hte rechts: LÃ¼cke fÃ¼r R2 -->
    <line x1="350" y1="30" x2="350" y2="80" stroke="var(--accent2)" stroke-width="2"/>
    <line x1="350" y1="150" x2="350" y2="190" stroke="var(--accent2)" stroke-width="2"/>
    <!-- Draht unten -->
    <line x1="350" y1="190" x2="50" y2="190" stroke="var(--accent2)" stroke-width="2"/>
    <!-- Draht links: LÃ¼cke fÃ¼r Quelle -->
    <line x1="50" y1="190" x2="50" y2="132" stroke="var(--accent2)" stroke-width="2"/>
    <line x1="50" y1="88" x2="50" y2="30" stroke="var(--accent2)" stroke-width="2"/>
    <!-- R1 oben -->
    <rect x="150" y="20" width="80" height="20" fill="none" stroke="var(--accent2)" stroke-width="2.5"/>
    <text x="190" y="15" text-anchor="middle" fill="#81c784" font-size="14" font-weight="600">Râ‚</text>
    <!-- R2 rechts -->
    <rect x="340" y="80" width="20" height="70" fill="none" stroke="var(--accent2)" stroke-width="2.5"/>
    <text x="375" y="120" text-anchor="start" fill="#81c784" font-size="14" font-weight="600">Râ‚‚</text>
    <!-- Spannungsquelle links -->
    <circle cx="50" cy="110" r="22" fill="none" stroke="var(--accent2)" stroke-width="2"/>
    <line x1="50" y1="88" x2="50" y2="132" stroke="var(--accent2)" stroke-width="2"/>
    <text x="72" y="98" text-anchor="start" fill="#ffa726" font-size="14" font-weight="700">+</text>
    <text x="72" y="130" text-anchor="start" fill="#ffa726" font-size="14" font-weight="700">âˆ’</text>
    <text x="20" y="114" text-anchor="end" fill="#ffa726" font-size="13" font-weight="600">Uâ‚€</text>
    <!-- Strompfeil oben: I flieÃŸt nach rechts -->
    <line x1="90" y1="30" x2="120" y2="30" stroke="#ffa726" stroke-width="2" marker-end="url(#arw-ex)"/>
    <text x="105" y="22" text-anchor="middle" fill="#ffa726" font-size="12">I</text>
    <!-- Umlaufrichtung: groÃŸer Pfeil im Uhrzeigersinn -->
    <text x="200" y="125" text-anchor="middle" fill="#ffa726" font-size="14" font-weight="700">â†» Umlauf</text>
    <!-- Spannungspfeile an den Bauteilen -->
    <!-- U_R1: + links, - rechts (in Stromrichtung) -->
    <text x="148" y="50" text-anchor="end" fill="#81c784" font-size="11">+</text>
    <text x="233" y="50" text-anchor="start" fill="#81c784" font-size="11">âˆ’</text>
    <text x="190" y="55" text-anchor="middle" fill="#81c784" font-size="11">U<tspan baseline-shift="sub" font-size="9">R1</tspan></text>
    <!-- U_R2: + oben, - unten (in Stromrichtung nach unten) -->
    <text x="330" y="82" text-anchor="end" fill="#81c784" font-size="11">+</text>
    <text x="330" y="155" text-anchor="end" fill="#81c784" font-size="11">âˆ’</text>
    <text x="325" y="120" text-anchor="end" fill="#81c784" font-size="11">U<tspan baseline-shift="sub" font-size="9">R2</tspan></text>
    <!-- Knoten -->
    <circle cx="50" cy="30" r="4" fill="var(--accent)"/>
    <circle cx="350" cy="30" r="4" fill="var(--accent)"/>
    <circle cx="350" cy="190" r="4" fill="var(--accent)"/>
    <circle cx="50" cy="190" r="4" fill="var(--accent)"/>
  </svg>

  <p>Umlauf im Uhrzeigersinn, Start bei der Quelle (unten links):</p>
  <ol>
    <li><strong>Uâ‚€:</strong> Wir gehen von âˆ’ nach + durch die Quelle â†’ Spannungs<em>anstieg</em> â†’ <strong style="color:var(--ok)">+Uâ‚€</strong></li>
    <li><strong>Râ‚:</strong> Wir gehen von + nach âˆ’ (in Stromrichtung) â†’ Spannungs<em>abfall</em> â†’ <strong style="color:var(--err)">âˆ’Râ‚Â·I</strong></li>
    <li><strong>Râ‚‚:</strong> Wir gehen von + nach âˆ’ (in Stromrichtung) â†’ Spannungs<em>abfall</em> â†’ <strong style="color:var(--err)">âˆ’Râ‚‚Â·I</strong></li>
  </ol>
  <div class="formula">+Uâ‚€ âˆ’ Râ‚Â·I âˆ’ Râ‚‚Â·I = 0 &nbsp; âŸº &nbsp; Uâ‚€ = Râ‚Â·I + Râ‚‚Â·I = (Râ‚+Râ‚‚)Â·I</div>
  <p style="color:var(--fg2);font-size:.9rem"><em>Das kennt ihr schon â€” es ist einfach das ohmsche Gesetz fÃ¼r eine Reihenschaltung! Die Maschenregel ist die Verallgemeinerung davon.</em></p>

  <h3 style="margin-top:.8rem">Anwendung auf die Wheatstone-BrÃ¼cke: Masche M1 (Aâ†’Bâ†’Dâ†’A)</h3>
  <p>Umlaufrichtung: A â†’ B â†’ D â†’ zurÃ¼ck zur Quelle â†’ A</p>
  <ol>
    <li><strong>Râ‚ (Aâ†’B):</strong> Strom Iâ‚ flieÃŸt Aâ†’B, wir gehen Aâ†’B = <em>in Stromrichtung</em> â†’ <strong style="color:var(--err)">âˆ’Râ‚Â·Iâ‚</strong></li>
    <li><strong>Râ‚ƒ (Bâ†’D):</strong> Strom Iâ‚ƒ flieÃŸt Bâ†’D, wir gehen Bâ†’D = <em>in Stromrichtung</em> â†’ <strong style="color:var(--err)">âˆ’Râ‚ƒÂ·Iâ‚ƒ</strong></li>
    <li><strong>Uâ‚€ (Dâ†’A Ã¼ber Quelle):</strong> Wir gehen von âˆ’ nach + â†’ <strong style="color:var(--ok)">+Uâ‚€</strong></li>
  </ol>
  <div class="formula">+Uâ‚€ âˆ’ Râ‚Â·Iâ‚ âˆ’ Râ‚ƒÂ·Iâ‚ƒ = 0 &nbsp; âŸº &nbsp; Uâ‚€ = Râ‚Â·Iâ‚ + Râ‚ƒÂ·Iâ‚ƒ</div>
</div>

<div class="warn-box">
  <strong>âš ï¸ HÃ¤ufiger Fehler: Vorzeichenkonvention!</strong><br>
  Lege <strong>zuerst</strong> alle Stromrichtungen fest (beliebig, aber dann <strong>konsistent</strong> bleiben!). Wenn das Ergebnis negativ wird, flieÃŸt der Strom eben andersrum. Das ist kein Fehler!<br><br>
  <strong>Typischer Fehler:</strong> Stromrichtung in der Knotengleichung anders definieren als in der Maschengleichung â†’ Widerspruch!
</div>

<h3>Unsere Stromrichtungen (Konvention)</h3>
<p>Wir definieren fÃ¼r die Wheatstone-BrÃ¼cke:</p>
<ul>
  <li><strong>Iâ‚</strong>: A â†’ B (durch Râ‚)</li>
  <li><strong>Iâ‚‚</strong>: A â†’ C (durch Râ‚‚)</li>
  <li><strong>Iâ‚ƒ</strong>: B â†’ D (durch Râ‚ƒ)</li>
  <li><strong>Iâ‚„</strong>: C â†’ D (durch Râ‚„)</li>
  <li><strong>Iâ‚…</strong>: B â†’ C (durch Râ‚…) &nbsp;â† <em>konsistent festgelegt!</em></li>
</ul>

<h3>Knotenregel anwenden</h3>
<p>WÃ¤hle einen Knoten und trage die Gleichung ein:</p>
<div style="margin:.5rem 0">
  <span class="node-sel active" onclick="selNode(this,'A')" id="node-A">A</span>
  <span class="node-sel" onclick="selNode(this,'B')" id="node-B">B</span>
  <span class="node-sel" onclick="selNode(this,'C')" id="node-C">C</span>
  <span class="node-sel" onclick="selNode(this,'D')" id="node-D">D</span>
</div>
<div id="node-hint" class="theory" style="font-size:.9rem"></div>
<p style="margin-top:.5rem">Trage die Knotengleichung ein (z.B. <code>I1+I2=I0</code> oder <code>I1-I3-I5=0</code>):</p>
<div class="input-group">
  <input type="text" id="node-eq" style="width:250px;text-align:left" placeholder="z.B. I1-I3-I5=0">
  <button onclick="checkNodeEq()">PrÃ¼fen</button>
</div>
<div class="result" id="node-eq-result"></div>

<h3>Maschenregel anwenden</h3>
<p>WÃ¤hle eine Masche:</p>
<div style="margin:.5rem 0">
  <span class="mesh-sel active" onclick="selMesh(this,'M1')" id="mesh-M1">M1: Aâ†’Bâ†’Dâ†’A</span>
  <span class="mesh-sel" onclick="selMesh(this,'M2')" id="mesh-M2">M2: Aâ†’Câ†’Dâ†’A</span>
  <span class="mesh-sel" onclick="selMesh(this,'M3')" id="mesh-M3">M3: Bâ†’Câ†’Dâ†’B</span>
</div>
<div id="mesh-hint" class="theory" style="font-size:.9rem"></div>
<p style="margin-top:.5rem">Trage die Maschengleichung ein (z.B. <code>U0-R1*I1-R3*I3=0</code>):</p>
<div class="input-group">
  <input type="text" id="mesh-eq" style="width:300px;text-align:left" placeholder="z.B. U0-R1*I1-R3*I3=0">
  <button onclick="checkMeshEq()">PrÃ¼fen</button>
</div>
<div class="result" id="mesh-eq-result"></div>

<h3>Vorzeichenkonvention â€“ Ãœbung</h3>
<p>Gegeben: Am Knoten B gilt Iâ‚ = Iâ‚ƒ + Iâ‚…. In Masche M3 (Bâ†’Câ†’Dâ†’B) kommt Râ‚… vor.</p>
<p><strong>Frage:</strong> Welches Vorzeichen hat Râ‚…Â·Iâ‚… in Masche M3 (Umlaufrichtung Bâ†’C)?</p>
<div class="choice-btns">
  <button onclick="signQuiz(this,false)">+Râ‚…Â·Iâ‚… (positiv)</button>
  <button onclick="signQuiz(this,true)">âˆ’Râ‚…Â·Iâ‚… (negativ)</button>
</div>
<div class="result" id="sign-quiz-result"></div>
<div class="result info" id="sign-explain" style="display:none">
  <strong>ErklÃ¤rung:</strong> Iâ‚… flieÃŸt Bâ†’C. Die Masche M3 geht Bâ†’Câ†’Dâ†’B. Im Abschnitt Bâ†’C ist die Umlaufrichtung <em>gleich</em> der Stromrichtung. Also ist der Spannungsabfall +Râ‚…Â·Iâ‚…. Aber die Maschengleichung heiÃŸt âˆ‘U=0, d.h. wir subtrahieren SpannungsabfÃ¤lle:<br>
  <strong>âˆ’Râ‚…Â·Iâ‚… âˆ’ Râ‚„Â·Iâ‚„ + Râ‚ƒÂ·Iâ‚ƒ = 0</strong><br>
  Alternativ: <strong>Râ‚…Â·Iâ‚… + Râ‚„Â·Iâ‚„ = Râ‚ƒÂ·Iâ‚ƒ</strong><br><br>
  Achtung: Je nach Umlaufrichtung Ã¤ndert sich das Vorzeichen. Entscheidend ist die <strong>Konsistenz</strong>!
</div>
</section>

<!-- ===== KAPITEL 5: GLEICHUNGSSYSTEM ===== -->
<section id="ch4">
<h2>5 Â· Gleichungssystem aufstellen & lÃ¶sen</h2>

<div class="theory">
  <p>FÃ¼r die Wheatstone-BrÃ¼cke mit 5 unbekannten StrÃ¶men (Iâ‚..Iâ‚…) brauchen wir <strong>5 Gleichungen</strong>:</p>
  <ul>
    <li>2 Knotengleichungen (z.B. Knoten B und C)</li>
    <li>3 Maschengleichungen (z.B. M1, M2, M3)</li>
  </ul>
  <p>Aber: Nur 2 Knoten + 2 Maschen + 1 weitere Beziehung sind unabhÃ¤ngig. Wir verwenden 3 Maschen (eine ist redundant als Check).</p>
</div>

<h3>Die 5 Gleichungen (Default-Werte)</h3>
<div class="theory" style="font-family:monospace;font-size:1rem;line-height:1.8">
  <strong>Knoten A:</strong> Iâ‚€ = Iâ‚ + Iâ‚‚<br>
  <strong>Knoten B:</strong> Iâ‚ = Iâ‚ƒ + Iâ‚…<br>
  <strong>Knoten C:</strong> Iâ‚‚ + Iâ‚… = Iâ‚„ &nbsp;(bzw. Iâ‚‚ âˆ’ Iâ‚„ + Iâ‚… = 0)<br>
  <strong>Masche M1 (A-B-D-A):</strong> Uâ‚€ = Râ‚Â·Iâ‚ + Râ‚ƒÂ·Iâ‚ƒ<br>
  <strong>Masche M2 (A-C-D-A):</strong> Uâ‚€ = Râ‚‚Â·Iâ‚‚ + Râ‚„Â·Iâ‚„<br>
  <strong>Masche M3 (B-C-D-B):</strong> Râ‚…Â·Iâ‚… + Râ‚„Â·Iâ‚„ âˆ’ Râ‚ƒÂ·Iâ‚ƒ = 0
</div>

<h3>Koeffizienten-Matrix eingeben</h3>
<p>Trage die Koeffizienten ein. Format: <code>aâ‚Â·Iâ‚ + aâ‚‚Â·Iâ‚‚ + aâ‚ƒÂ·Iâ‚ƒ + aâ‚„Â·Iâ‚„ + aâ‚…Â·Iâ‚… = b</code></p>
<table class="eq-table" id="eq-table">
  <tr><th></th><th>Iâ‚</th><th>Iâ‚‚</th><th>Iâ‚ƒ</th><th>Iâ‚„</th><th>Iâ‚…</th><th>=</th><th>b</th></tr>
  <tr><td>Knoten B</td><td><input id="eq00" value="1"></td><td><input id="eq01" value="0"></td><td><input id="eq02" value="-1"></td><td><input id="eq03" value="0"></td><td><input id="eq04" value="-1"></td><td>=</td><td><input id="eq05" value="0"></td></tr>
  <tr><td>Knoten C</td><td><input id="eq10" value="0"></td><td><input id="eq11" value="1"></td><td><input id="eq12" value="0"></td><td><input id="eq13" value="-1"></td><td><input id="eq14" value="1"></td><td>=</td><td><input id="eq15" value="0"></td></tr>
  <tr><td>Masche 1</td><td><input id="eq20" value="100"></td><td><input id="eq21" value="0"></td><td><input id="eq22" value="330"></td><td><input id="eq23" value="0"></td><td><input id="eq24" value="0"></td><td>=</td><td><input id="eq25" value="12"></td></tr>
  <tr><td>Masche 2</td><td><input id="eq30" value="0"></td><td><input id="eq31" value="220"></td><td><input id="eq32" value="0"></td><td><input id="eq33" value="470"></td><td><input id="eq34" value="0"></td><td>=</td><td><input id="eq35" value="12"></td></tr>
  <tr><td>Masche 3</td><td><input id="eq40" value="0"></td><td><input id="eq41" value="0"></td><td><input id="eq42" value="-330"></td><td><input id="eq43" value="470"></td><td><input id="eq44" value="150"></td><td>=</td><td><input id="eq45" value="0"></td></tr>
</table>

<div style="display:flex;gap:.5rem;flex-wrap:wrap;margin:.8rem 0">
  <button onclick="checkEqSystem()">Gleichungen prÃ¼fen</button>
  <button onclick="solveSystem()" class="secondary">LÃ¶sen (GauÃŸ)</button>
  <button onclick="showCAS()" class="secondary">CAS Syntax anzeigen</button>
</div>

<div class="result" id="eq-check-result"></div>
<div class="result" id="eq-solve-result"></div>

<div class="cas-box" style="display:none" id="cas-box">
  <div class="cas-label">ğŸ“± ClassPad Eingabe:</div>
solve({
  I1-I3-I5=0,
  I2-I4+I5=0,
  100*I1+330*I3=12,
  220*I2+470*I4=12,
  -330*I3+470*I4+150*I5=0
},{I1,I2,I3,I4,I5})
</div>

<div class="cas-box" style="display:none" id="cas-box-nspire">
  <div class="cas-label">ğŸ–© TI-Nspire CX Eingabe:</div>
<strong>Variante 1: solve()</strong>
solve(i1-i3-i5=0 and i2-i4+i5=0 and 100Â·i1+330Â·i3=12 and 220Â·i2+470Â·i4=12 and -330Â·i3+470Â·i4+150Â·i5=0, {i1,i2,i3,i4,i5})

<strong>Variante 2: MenÃ¼ â†’ Algebra â†’ Gleichungssystem lÃ¶sen</strong>
Anzahl Gleichungen: 5
  i1-i3-i5=0
  i2-i4+i5=0
  100Â·i1+330Â·i3=12
  220Â·i2+470Â·i4=12
  -330Â·i3+470Â·i4+150Â·i5=0
Variablen: i1,i2,i3,i4,i5

<em>Tipp: Â· Ã¼ber die Multiplikationstaste, Variablen klein schreiben</em>
</div>
</section>

<!-- ===== KAPITEL 6: FREIER RECHNER ===== -->
<section id="ch5">
<h2>6 Â· Freier Rechner</h2>

<div class="theory">
  <p>Gib eigene Werte ein und berechne sofort alle StrÃ¶me, Spannungen und R<sub>ges</sub> der Wheatstone-BrÃ¼cke.</p>
</div>

<svg class="circuit" viewBox="-90 0 500 360" id="svg-calc">
  <defs><marker id="arw2" viewBox="0 0 10 10" refX="10" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="#ffa726"/></marker></defs>
  <!-- R1: A to B -->
  <line x1="200" y1="30" x2="155" y2="77" class="wire"/>
  <polygon points="147,70 98,121 113,135 162,84" fill="none" stroke="var(--accent2)" stroke-width="2.5"/>
  <line x1="106" y1="128" x2="60" y2="175" class="wire"/>
  <text x="108" y="84" text-anchor="end" fill="#81c784" font-weight="600" font-size="15" id="calc-r1-label">Râ‚</text>
  <line x1="172" y1="59" x2="164" y2="68" stroke="#ffa726" stroke-width="2" marker-end="url(#arw2)"/>
  <text x="145" y="52" text-anchor="end" fill="#ffa726" font-size="12" id="calc-i1-svg">Iâ‚</text>
  <!-- R2: A to C -->
  <line x1="200" y1="30" x2="246" y2="77" class="wire"/>
  <polygon points="238,84 288,135 302,121 253,70" fill="none" stroke="var(--accent2)" stroke-width="2.5"/>
  <line x1="295" y1="128" x2="340" y2="175" class="wire"/>
  <text x="292" y="84" text-anchor="start" fill="#81c784" font-weight="600" font-size="15" id="calc-r2-label">Râ‚‚</text>
  <line x1="228" y1="59" x2="236" y2="68" stroke="#ffa726" stroke-width="2" marker-end="url(#arw2)"/>
  <text x="255" y="52" text-anchor="start" fill="#ffa726" font-size="12" id="calc-i2-svg">Iâ‚‚</text>
  <!-- R3: B to D -->
  <line x1="60" y1="175" x2="106" y2="222" class="wire"/>
  <polygon points="98,229 147,280 162,266 113,215" fill="none" stroke="var(--accent2)" stroke-width="2.5"/>
  <line x1="155" y1="273" x2="200" y2="320" class="wire"/>
  <text x="108" y="266" text-anchor="end" fill="#81c784" font-weight="600" font-size="15" id="calc-r3-label">Râ‚ƒ</text>
  <line x1="88" y1="204" x2="96" y2="213" stroke="#ffa726" stroke-width="2" marker-end="url(#arw2)"/>
  <text x="62" y="210" text-anchor="end" fill="#ffa726" font-size="12" id="calc-i3-svg">Iâ‚ƒ</text>
  <!-- R4: C to D -->
  <line x1="340" y1="175" x2="295" y2="222" class="wire"/>
  <polygon points="287,215 238,266 253,280 302,229" fill="none" stroke="var(--accent2)" stroke-width="2.5"/>
  <line x1="246" y1="273" x2="200" y2="320" class="wire"/>
  <text x="292" y="266" text-anchor="start" fill="#81c784" font-weight="600" font-size="15" id="calc-r4-label">Râ‚„</text>
  <line x1="312" y1="204" x2="304" y2="213" stroke="#ffa726" stroke-width="2" marker-end="url(#arw2)"/>
  <text x="338" y="210" text-anchor="start" fill="#ffa726" font-size="12" id="calc-i4-svg">Iâ‚„</text>
  <!-- R5: B to C (bridge) -->
  <line x1="60" y1="175" x2="151" y2="175" class="wire"/>
  <rect x="151" y="165" width="98" height="20" fill="none" stroke="var(--warn)" stroke-width="2.5"/>
  <line x1="249" y1="175" x2="340" y2="175" class="wire"/>
  <text x="200" y="158" text-anchor="middle" fill="#ffa726" font-weight="700" font-size="15" id="calc-r5-label">Râ‚…</text>
  <line x1="108" y1="175" x2="120" y2="175" stroke="#ffa726" stroke-width="2" marker-end="url(#arw2)"/>
  <text x="100" y="168" text-anchor="end" fill="#ffa726" font-size="12" id="calc-i5-svg">Iâ‚…</text>
  <!-- Spannungsquelle Uâ‚€: A links runter nach D -->
  <line x1="200" y1="30" x2="-30" y2="30" class="wire"/>
  <line x1="-30" y1="30" x2="-30" y2="150" class="wire"/>
  <circle cx="-30" cy="175" r="25" fill="none" stroke="var(--accent2)" stroke-width="2"/>
  <line x1="-30" y1="150" x2="-30" y2="200" stroke="var(--accent2)" stroke-width="2"/>
  <text x="-2" y="160" text-anchor="start" fill="#ffa726" font-size="14" font-weight="700">+</text>
  <text x="-2" y="198" text-anchor="start" fill="#ffa726" font-size="14" font-weight="700">âˆ’</text>
  <text x="-62" y="180" text-anchor="end" fill="#ffa726" font-size="13" font-weight="600">Uâ‚€</text>
  <line x1="-30" y1="200" x2="-30" y2="320" class="wire"/>
  <line x1="-30" y1="320" x2="200" y2="320" class="wire"/>
  <!-- Nodes -->
  <circle cx="200" cy="30" r="5" class="node-dot"/>
  <text x="200" y="15" text-anchor="middle" fill="#4caf50" font-weight="700" font-size="16">A</text>
  <circle cx="60" cy="175" r="5" class="node-dot"/>
  <text x="38" y="180" text-anchor="end" fill="#4caf50" font-weight="700" font-size="16">B</text>
  <circle cx="340" cy="175" r="5" class="node-dot"/>
  <text x="362" y="180" text-anchor="start" fill="#4caf50" font-weight="700" font-size="16">C</text>
  <circle cx="200" cy="320" r="5" class="node-dot"/>
  <text x="200" y="342" text-anchor="middle" fill="#4caf50" font-weight="700" font-size="16">D</text>
</svg>

<div class="input-group">
  <label>Râ‚:</label><input type="number" id="calc-r1" value="100" min="1" oninput="calcAll()"><span class="unit">Î©</span>
  <label>Râ‚‚:</label><input type="number" id="calc-r2" value="220" min="1" oninput="calcAll()"><span class="unit">Î©</span>
</div>
<div class="input-group">
  <label>Râ‚ƒ:</label><input type="number" id="calc-r3" value="330" min="1" oninput="calcAll()"><span class="unit">Î©</span>
  <label>Râ‚„:</label><input type="number" id="calc-r4" value="470" min="1" oninput="calcAll()"><span class="unit">Î©</span>
</div>
<div class="input-group">
  <label>Râ‚…:</label><input type="number" id="calc-r5" value="150" min="1" oninput="calcAll()"><span class="unit">Î©</span>
  <label>Uâ‚€:</label><input type="number" id="calc-u0" value="12" min="0.1" step="0.1" oninput="calcAll()"><span class="unit">V</span>
</div>

<div class="result info show" id="calc-result">
  <div class="result-grid" id="calc-result-grid"></div>
</div>

<div class="theory" style="margin-top:1rem">
  <h3>Abgleich-Check</h3>
  <div id="calc-balance"></div>
</div>

<div class="cas-box" id="calc-cas">
  <div class="cas-label">ğŸ“± ClassPad:</div>
  <span id="calc-cas-text"></span>
</div>
<div class="cas-box" id="calc-cas-nspire">
  <div class="cas-label">ğŸ–© TI-Nspire CX:</div>
  <span id="calc-cas-nspire-text"></span>
</div>
</section>
</main>

<script>
'use strict';

// ===== NAVIGATION =====
const sections = document.querySelectorAll('section');
const navLinks = document.querySelectorAll('nav a[data-ch]');
const completed = new Set();

function goTo(ch) {
  sections.forEach((s,i) => { s.classList.toggle('active', i===ch); });
  navLinks.forEach((a,i) => { a.classList.toggle('active', i===ch); });
  document.querySelector('nav').classList.remove('open');
  window.scrollTo(0,0);
}

navLinks.forEach(a => a.addEventListener('click', e => { e.preventDefault(); goTo(+a.dataset.ch); }));

function markDone(ch) {
  completed.add(ch);
  navLinks[ch].querySelector('.ch-check').classList.add('done');
  const pct = Math.round(completed.size/6*100);
  document.getElementById('progressFill').style.width = pct+'%';
  document.getElementById('progressLabel').textContent = completed.size+' / 6 abgeschlossen';
}

function showResult(id, ok, msg) {
  const el = document.getElementById(id);
  el.className = 'result show ' + (ok ? 'ok' : 'err');
  el.innerHTML = (ok ? 'âœ“ ' : 'âœ— ') + msg;
}

// ===== CH1: PARALLEL =====
function parCalc() {
  const r1=+document.getElementById('par-r1').value;
  const r2=+document.getElementById('par-r2').value;
  const r3=+document.getElementById('par-r3').value;
  const u=+document.getElementById('par-u').value;
  document.getElementById('par-r1-val').textContent=r1+' Î©';
  document.getElementById('par-r2-val').textContent=r2+' Î©';
  document.getElementById('par-r3-val').textContent=r3+' Î©';
  document.getElementById('par-u-val').textContent=u+' V';
  document.getElementById('par-r1-label').textContent='Râ‚ = '+r1+' Î©';
  document.getElementById('par-r2-label').textContent='Râ‚‚ = '+r2+' Î©';
  document.getElementById('par-r3-label').textContent='Râ‚ƒ = '+r3+' Î©';
  const rg = 1/(1/r1+1/r2+1/r3);
  const ig = u/rg;
  const i1=u/r1, i2=u/r2, i3=u/r3;
  // show flow animation
  ['par-flow1','par-flow2','par-flow3'].forEach(id => document.getElementById(id).style.opacity='.6');
  document.getElementById('par-result-grid').innerHTML = [
    item('R<sub>ges</sub>', rg.toFixed(2)+' Î©'),
    item('I<sub>ges</sub>', (ig*1000).toFixed(1)+' mA'),
    item('Iâ‚', (i1*1000).toFixed(1)+' mA'),
    item('Iâ‚‚', (i2*1000).toFixed(1)+' mA'),
    item('Iâ‚ƒ', (i3*1000).toFixed(1)+' mA'),
    item('U', u.toFixed(1)+' V'),
  ].join('');
}

function item(l,v) { return `<div class="item"><div class="lbl">${l}</div><div class="val">${v}</div></div>`; }

function parCheck() {
  const ans = +document.getElementById('par-quiz').value;
  const correct = 1/(1/150+1/300); // 100
  if(Math.abs(ans-correct)<1) { showResult('par-quiz-result',true,'Richtig! R<sub>ges</sub> = 100 Î©'); markDone(0); }
  else showResult('par-quiz-result',false,'Falsch. Tipp: 1/R<sub>ges</sub> = 1/150 + 1/300');
}

parCalc();

// ===== CH2: MIXED =====
let mixStep = 1;
function mixChoice(step, choice) {
  if(step!==1) return;
  const ok = choice==='r2r3';
  showResult('mix-step1-result', ok, ok ? 'Richtig! Râ‚‚ und Râ‚ƒ liegen parallel.' : 'Falsch â€“ schau dir an, welche WiderstÃ¤nde die gleichen Knoten teilen.');
  if(ok) { document.getElementById('mix-step2').style.opacity='1'; mixStep=2; }
}
function mixCheck2() {
  const ans = +document.getElementById('mix-r23').value;
  const correct = 1/(1/220+1/330); // â‰ˆ132
  if(Math.abs(ans-correct)<1) { showResult('mix-step2-result',true,'Richtig! Râ‚‚â‚ƒ â‰ˆ '+correct.toFixed(1)+' Î©'); document.getElementById('mix-step3').style.opacity='1'; mixStep=3; }
  else showResult('mix-step2-result',false,'Falsch. Râ‚‚â‚ƒ = 1/(1/220 + 1/330) â‰ˆ '+correct.toFixed(1)+' Î©');
}
function mixCheck3() {
  const r23 = 1/(1/220+1/330);
  const correct = 100 + r23;
  const ans = +document.getElementById('mix-rges').value;
  if(Math.abs(ans-correct)<1) { showResult('mix-step3-result',true,'Richtig! R<sub>ges</sub> â‰ˆ '+correct.toFixed(1)+' Î©'); markDone(1); }
  else showResult('mix-step3-result',false,'Falsch. R<sub>ges</sub> = Râ‚ + Râ‚‚â‚ƒ = 100 + '+r23.toFixed(1)+' â‰ˆ '+correct.toFixed(1)+' Î©');
}

// ===== CH3: WHEATSTONE QUIZ =====
function wheatQuiz(btn, ok) {
  showResult('wheat-quiz-result', ok, ok ? 'Richtig! Râ‚Â·Râ‚„ = Râ‚‚Â·Râ‚ƒ ist die Abgleichbedingung.' : 'Falsch â€“ es ist ein Produkt, keine Summe!');
  if(ok) markDone(2);
}

// ===== CH4: KIRCHHOFF =====
let currentNode = 'A';
const nodeEqs = {
  A: {hint:'Am Knoten A: Der Gesamtstrom teilt sich in Iâ‚ und Iâ‚‚.', valid:['I1+I2','I0']},
  B: {hint:'Am Knoten B: Iâ‚ kommt an, Iâ‚ƒ und Iâ‚… gehen ab.', check: coeffs => coeffs[0]===1 && coeffs[2]===-1 && coeffs[4]===-1 && coeffs[1]===0 && coeffs[3]===0},
  C: {hint:'Am Knoten C: Iâ‚‚ und Iâ‚… kommen an, Iâ‚„ geht ab.', check: coeffs => coeffs[1]===1 && coeffs[4]===1 && coeffs[3]===-1 && coeffs[0]===0 && coeffs[2]===0},
  D: {hint:'Am Knoten D: Iâ‚ƒ und Iâ‚„ kommen an, der Strom flieÃŸt zurÃ¼ck zur Quelle.', valid:['I3+I4','I0']},
};

function selNode(el, node) {
  document.querySelectorAll('.node-sel').forEach(s=>s.classList.remove('active'));
  el.classList.add('active');
  currentNode = node;
  document.getElementById('node-hint').innerHTML = nodeEqs[node].hint;
}
selNode(document.getElementById('node-A'),'A');

function parseEqCoeffs(str) {
  // Parse simple equation like "I1-I3-I5=0" into coefficients [I1,I2,I3,I4,I5,rhs]
  str = str.replace(/\s/g,'').toUpperCase();
  const parts = str.split('=');
  if(parts.length!==2) return null;
  const lhs = parts[0], rhs = parseFloat(parts[1])||0;
  const coeffs = [0,0,0,0,0];
  const regex = /([+-]?)(\d*)I([1-5])/g;
  let m;
  while((m=regex.exec(lhs))!==null) {
    const sign = m[1]==='-' ? -1 : 1;
    const coeff = m[2] ? parseInt(m[2]) : 1;
    coeffs[parseInt(m[3])-1] = sign*coeff;
  }
  return {coeffs, rhs};
}

function checkNodeEq() {
  const input = document.getElementById('node-eq').value.trim();
  if(!input) return;
  const parsed = parseEqCoeffs(input);
  if(!parsed) { showResult('node-eq-result',false,'Konnte die Gleichung nicht parsen. Format: I1-I3-I5=0'); return; }
  // Check based on current node
  let ok = false;
  if(currentNode==='B') { ok = parsed.coeffs[0]===1 && parsed.coeffs[2]===-1 && parsed.coeffs[4]===-1 && parsed.coeffs[1]===0 && parsed.coeffs[3]===0 && parsed.rhs===0; }
  else if(currentNode==='C') {
    // I2+I5-I4=0 or I2-I4+I5=0
    ok = parsed.coeffs[1]===1 && parsed.coeffs[3]===-1 && parsed.coeffs[4]===1 && parsed.coeffs[0]===0 && parsed.coeffs[2]===0 && parsed.rhs===0;
    // also accept I4=I2+I5 â†’ rearranged: -I2+I4-I5=0
    if(!ok) ok = parsed.coeffs[1]===-1 && parsed.coeffs[3]===1 && parsed.coeffs[4]===-1 && parsed.coeffs[0]===0 && parsed.coeffs[2]===0 && parsed.rhs===0;
  }
  else if(currentNode==='A') {
    // I1+I2 on left â†’ not easily checkable without I0, just accept common forms
    showResult('node-eq-result',true,'FÃ¼r Knoten A verwenden wir Iâ‚€ = Iâ‚ + Iâ‚‚. Da Iâ‚€ keine unserer 5 Unbekannten ist, nutzen wir lieber Knoten B und C!');
    return;
  }
  else if(currentNode==='D') {
    showResult('node-eq-result',true,'FÃ¼r Knoten D: Iâ‚ƒ + Iâ‚„ = Iâ‚€. Auch hier kommt Iâ‚€ vor. Besser: Knoten B und C verwenden!');
    return;
  }
  showResult('node-eq-result', ok, ok ? 'Richtig! âœ“' : 'Nicht ganz. Tipp: '+nodeEqs[currentNode].hint);
}

let currentMesh = 'M1';
const meshInfo = {
  M1: {hint:'Masche 1 (Aâ†’Bâ†’Dâ†’A, im Uhrzeigersinn): Uâ‚€ âˆ’ Râ‚Â·Iâ‚ âˆ’ Râ‚ƒÂ·Iâ‚ƒ = 0'},
  M2: {hint:'Masche 2 (Aâ†’Câ†’Dâ†’A, im Uhrzeigersinn): Uâ‚€ âˆ’ Râ‚‚Â·Iâ‚‚ âˆ’ Râ‚„Â·Iâ‚„ = 0'},
  M3: {hint:'Masche 3 (Bâ†’Câ†’Dâ†’B): Râ‚…Â·Iâ‚… + Râ‚„Â·Iâ‚„ âˆ’ Râ‚ƒÂ·Iâ‚ƒ = 0'},
};

function selMesh(el, mesh) {
  document.querySelectorAll('.mesh-sel').forEach(s=>s.classList.remove('active'));
  el.classList.add('active');
  currentMesh = mesh;
  document.getElementById('mesh-hint').innerHTML = meshInfo[mesh].hint;
}
selMesh(document.getElementById('mesh-M1'),'M1');

function checkMeshEq() {
  const input = document.getElementById('mesh-eq').value.trim();
  if(!input) return;
  // Simple validation: just show the correct answer
  const correct = meshInfo[currentMesh].hint;
  showResult('mesh-eq-result', true, 'Korrekte Form: ' + correct + '<br>Vergleiche mit deiner Eingabe!');
}

function signQuiz(btn, ok) {
  // The question asks about the sign of R5*I5 in mesh M3 going Bâ†’C
  // I5 goes Bâ†’C, mesh goes Bâ†’C â†’ same direction â†’ voltage DROP â†’ in âˆ‘U=0 it's âˆ’R5Â·I5
  // Wait, let me reconsider. If going Bâ†’C and current is Bâ†’C, voltage drops: U_R5 = -R5*I5 in KVL
  // Actually the convention: going WITH current direction = voltage drop = subtract
  // So âˆ’Râ‚…Â·Iâ‚… is correct in âˆ‘U=0
  showResult('sign-quiz-result', ok, ok ? 'Richtig! In der Maschengleichung (âˆ‘U=0) wird der Spannungsabfall subtrahiert, wenn Umlauf- und Stromrichtung Ã¼bereinstimmen.' : 'Nicht ganz â€“ denk daran: Umlaufrichtung = Stromrichtung â†’ Spannungsabfall â†’ negatives Vorzeichen in âˆ‘U=0.');
  document.getElementById('sign-explain').style.display = ok ? 'block' : 'none';
  if(ok) markDone(3);
}

// ===== CH5: EQUATION SYSTEM =====
function getEqMatrix() {
  const A=[], b=[];
  for(let i=0;i<5;i++) {
    A.push([]);
    for(let j=0;j<5;j++) A[i].push(parseFloat(document.getElementById('eq'+i+j).value)||0);
    b.push(parseFloat(document.getElementById('eq'+i+5).value)||0);
  }
  return {A,b};
}

// Correct matrix for default values
const correctA = [[1,0,-1,0,-1],[0,1,0,-1,1],[100,0,330,0,0],[0,220,0,470,0],[0,0,-330,470,150]];
const correctB = [0,0,12,12,0];

function checkEqSystem() {
  const {A,b} = getEqMatrix();
  let allOk = true;
  for(let i=0;i<5;i++) {
    for(let j=0;j<5;j++) {
      const el = document.getElementById('eq'+i+j);
      const ok = A[i][j]===correctA[i][j];
      el.className = ok ? 'ok' : 'err';
      if(!ok) allOk=false;
    }
    const el = document.getElementById('eq'+i+5);
    const ok = b[i]===correctB[i];
    el.className = ok ? 'ok' : 'err';
    if(!ok) allOk=false;
  }
  showResult('eq-check-result', allOk, allOk ? 'Alle Koeffizienten korrekt!' : 'Einige Koeffizienten stimmen nicht (rot markiert).');
  if(allOk) markDone(4);
}

function gaussSolve(A, b) {
  const n = A.length;
  // Augmented matrix
  const M = A.map((row,i)=>[...row, b[i]]);
  for(let col=0;col<n;col++) {
    // Pivot
    let maxRow=col;
    for(let row=col+1;row<n;row++) if(Math.abs(M[row][col])>Math.abs(M[maxRow][col])) maxRow=row;
    [M[col],M[maxRow]]=[M[maxRow],M[col]];
    if(Math.abs(M[col][col])<1e-12) return null;
    for(let row=col+1;row<n;row++) {
      const f=M[row][col]/M[col][col];
      for(let j=col;j<=n;j++) M[row][j]-=f*M[col][j];
    }
  }
  // Back substitution
  const x=new Array(n);
  for(let i=n-1;i>=0;i--) {
    x[i]=M[i][n];
    for(let j=i+1;j<n;j++) x[i]-=M[i][j]*x[j];
    x[i]/=M[i][i];
  }
  return x;
}

function solveSystem() {
  const {A,b} = getEqMatrix();
  const x = gaussSolve(A.map(r=>[...r]), [...b]);
  if(!x) { showResult('eq-solve-result',false,'Gleichungssystem ist nicht lÃ¶sbar (singulÃ¤re Matrix).'); return; }
  const [I1,I2,I3,I4,I5] = x;
  const I0 = I1+I2;
  const U0 = b[2]||12; // from mesh 1
  const Rges = U0/I0;
  const Ubc = I5 * (parseFloat(document.getElementById('eq44').value)||150); // R5*I5

  let html = '<strong>LÃ¶sung:</strong><br><div class="result-grid">';
  html += item('Iâ‚', (I1*1000).toFixed(3)+' mA');
  html += item('Iâ‚‚', (I2*1000).toFixed(3)+' mA');
  html += item('Iâ‚ƒ', (I3*1000).toFixed(3)+' mA');
  html += item('Iâ‚„', (I4*1000).toFixed(3)+' mA');
  html += item('Iâ‚…', (I5*1000).toFixed(3)+' mA');
  html += item('Iâ‚€ = Iâ‚+Iâ‚‚', (I0*1000).toFixed(3)+' mA');
  html += item('R<sub>ges</sub> = Uâ‚€/Iâ‚€', Rges.toFixed(2)+' Î©');
  html += item('U<sub>BC</sub> = Râ‚…Â·Iâ‚…', (Ubc*1000).toFixed(3)+' mV');
  html += '</div>';
  const el = document.getElementById('eq-solve-result');
  el.className = 'result show info';
  el.innerHTML = html;
}

function showCAS() {
  const box = document.getElementById('cas-box');
  const box2 = document.getElementById('cas-box-nspire');
  const show = box.style.display==='none' ? 'block' : 'none';
  box.style.display = show;
  box2.style.display = show;
}

// ===== CH6: FREE CALCULATOR =====
function solveWheatstone(R1,R2,R3,R4,R5,U0) {
  const A = [[1,0,-1,0,-1],[0,1,0,-1,1],[R1,0,R3,0,0],[0,R2,0,R4,0],[0,0,-R3,R4,R5]];
  const b = [0,0,U0,U0,0];
  return gaussSolve(A,b);
}

function calcAll() {
  const R1=+document.getElementById('calc-r1').value||100;
  const R2=+document.getElementById('calc-r2').value||220;
  const R3=+document.getElementById('calc-r3').value||330;
  const R4=+document.getElementById('calc-r4').value||470;
  const R5=+document.getElementById('calc-r5').value||150;
  const U0=+document.getElementById('calc-u0').value||12;

  // Update SVG labels
  document.getElementById('calc-r1-label').textContent = 'Râ‚='+R1+'Î©';
  document.getElementById('calc-r2-label').textContent = 'Râ‚‚='+R2+'Î©';
  document.getElementById('calc-r3-label').textContent = 'Râ‚ƒ='+R3+'Î©';
  document.getElementById('calc-r4-label').textContent = 'Râ‚„='+R4+'Î©';
  document.getElementById('calc-r5-label').textContent = 'Râ‚…='+R5+'Î©';

  const x = solveWheatstone(R1,R2,R3,R4,R5,U0);
  if(!x) { document.getElementById('calc-result-grid').innerHTML='<em>Nicht lÃ¶sbar</em>'; return; }
  const [I1,I2,I3,I4,I5] = x;
  const I0=I1+I2;
  const Rges=U0/I0;
  const Ubc=R5*I5;

  // SVG current labels
  const fmt = v => (v*1000).toFixed(2)+' mA';
  document.getElementById('calc-i1-svg').textContent = 'Iâ‚='+fmt(I1);
  document.getElementById('calc-i2-svg').textContent = 'Iâ‚‚='+fmt(I2);
  document.getElementById('calc-i3-svg').textContent = 'Iâ‚ƒ='+fmt(I3);
  document.getElementById('calc-i4-svg').textContent = 'Iâ‚„='+fmt(I4);
  document.getElementById('calc-i5-svg').textContent = 'Iâ‚…='+fmt(I5);

  let html = '';
  html += item('Iâ‚', fmt(I1));
  html += item('Iâ‚‚', fmt(I2));
  html += item('Iâ‚ƒ', fmt(I3));
  html += item('Iâ‚„', fmt(I4));
  html += item('Iâ‚…', fmt(I5));
  html += item('Iâ‚€', fmt(I0));
  html += item('R<sub>ges</sub>', Rges.toFixed(2)+' Î©');
  html += item('U<sub>BC</sub>', (Ubc*1000).toFixed(2)+' mV');
  html += item('U<sub>R1</sub>', (R1*I1*1000).toFixed(2)+' mV');
  html += item('U<sub>R2</sub>', (R2*I2*1000).toFixed(2)+' mV');
  html += item('U<sub>R3</sub>', (R3*I3*1000).toFixed(2)+' mV');
  html += item('U<sub>R4</sub>', (R4*I4*1000).toFixed(2)+' mV');
  document.getElementById('calc-result-grid').innerHTML = html;

  // Balance check
  const prod1 = R1*R4, prod2 = R2*R3;
  const balanced = Math.abs(prod1-prod2)<0.01;
  document.getElementById('calc-balance').innerHTML = `Râ‚Â·Râ‚„ = ${prod1} | Râ‚‚Â·Râ‚ƒ = ${prod2} â†’ ${balanced ? '<strong style="color:var(--ok)">Abgeglichen! Iâ‚…â‰ˆ0</strong>' : '<strong style="color:var(--warn)">Nicht abgeglichen (Iâ‚…â‰ 0)</strong>'}`;

  // CAS text
  document.getElementById('calc-cas-text').textContent =
`solve({
  I1-I3-I5=0,
  I2-I4+I5=0,
  ${R1}*I1+${R3}*I3=${U0},
  ${R2}*I2+${R4}*I4=${U0},
  -${R3}*I3+${R4}*I4+${R5}*I5=0
},{I1,I2,I3,I4,I5})`;

  document.getElementById('calc-cas-nspire-text').textContent =
`solve(i1-i3-i5=0 and i2-i4+i5=0 and ${R1}Â·i1+${R3}Â·i3=${U0} and ${R2}Â·i2+${R4}Â·i4=${U0} and -${R3}Â·i3+${R4}Â·i4+${R5}Â·i5=0, {i1,i2,i3,i4,i5})`;

  markDone(5);
}

calcAll();

// Init hints
document.getElementById('node-hint').innerHTML = nodeEqs['A'].hint;
document.getElementById('mesh-hint').innerHTML = meshInfo['M1'].hint;
</script>
</body>
</html>
