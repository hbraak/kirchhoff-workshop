<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Widerstandsnetzwerke ‚Äì Interaktiver Workshop</title>
<style>
:root {
  --bg: #0d1b0e; --bg2: #142116; --bg3: #1a2e1c;
  --fg: #e8f0e8; --fg2: #a8c4a8; --accent: #4caf50;
  --accent2: #81c784; --err: #ef5350; --ok: #66bb6a;
  --warn: #ffa726; --radius: 8px; --shadow: 0 2px 8px #0004;
}
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family: 'Segoe UI', system-ui, sans-serif; background:var(--bg); color:var(--fg); min-height:100vh; display:flex; font-size:18px; line-height:1.6; }
/* NAV */
nav { width:260px; min-height:100vh; background:var(--bg2); border-right:2px solid var(--accent); padding:1rem 0; position:fixed; top:0; left:0; z-index:100; display:flex; flex-direction:column; transition:transform .3s; }
nav.closed { transform:translateX(-260px); }
.nav-toggle { display:none; position:fixed; top:.5rem; left:.5rem; z-index:200; background:var(--accent); color:#fff; border:none; border-radius:var(--radius); width:44px; height:44px; font-size:1.5rem; cursor:pointer; }
nav h1 { font-size:1.1rem; padding:.5rem 1rem; color:var(--accent2); border-bottom:1px solid var(--bg3); margin-bottom:.5rem; }
nav a { display:block; padding:.6rem 1rem; color:var(--fg2); text-decoration:none; font-size:.95rem; border-left:3px solid transparent; transition:all .2s; }
nav a:hover, nav a.active { background:var(--bg3); color:var(--accent2); border-left-color:var(--accent); }
nav a .ch-num { display:inline-block; width:1.8em; font-weight:700; color:var(--accent); }
nav a .ch-check { float:right; opacity:0; transition:opacity .2s; }
nav a .ch-check.done { opacity:1; }
.progress-wrap { margin-top:auto; padding:.8rem 1rem; }
.progress-bar { height:6px; background:var(--bg); border-radius:3px; overflow:hidden; }
.progress-fill { height:100%; background:var(--accent); width:0%; transition:width .5s; }
.progress-label { font-size:.75rem; color:var(--fg2); margin-top:.3rem; text-align:center; }
/* MAIN */
main { margin-left:260px; flex:1; padding:2rem; max-width:960px; }
section { display:none; }
section.active { display:block; animation: fadeIn .3s; }
@keyframes fadeIn { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:none} }
h2 { color:var(--accent2); font-size:1.6rem; margin-bottom:1rem; border-bottom:2px solid var(--accent); padding-bottom:.4rem; }
h3 { color:var(--accent); margin:1.2rem 0 .5rem; font-size:1.15rem; }
p, li { margin-bottom:.5rem; }
ul { padding-left:1.5rem; }
/* COMPONENTS */
.theory { background:var(--bg3); border-left:4px solid var(--accent); padding:1rem 1.2rem; border-radius:0 var(--radius) var(--radius) 0; margin:1rem 0; }
.theory .formula { font-size:1.3rem; text-align:center; padding:.5rem; color:var(--accent2); font-weight:600; }
.warn-box { background:#2a1a00; border-left:4px solid var(--warn); padding:1rem 1.2rem; border-radius:0 var(--radius) var(--radius) 0; margin:1rem 0; color:#ffe0b2; }
.input-group { display:flex; flex-wrap:wrap; gap:.8rem; align-items:center; margin:.8rem 0; }
.input-group label { min-width:80px; font-weight:600; color:var(--fg2); }
.input-group input[type=number], .input-group input[type=text] { width:100px; padding:.4rem .6rem; background:var(--bg); border:1px solid var(--fg2); color:var(--fg); border-radius:var(--radius); font-size:1rem; text-align:right; }
.input-group input:focus { border-color:var(--accent); outline:none; }
.input-group .unit { color:var(--fg2); font-size:.9rem; margin-left:-.4rem; }
.slider-group { display:flex; align-items:center; gap:.6rem; margin:.4rem 0; flex-wrap:wrap; }
.slider-group label { min-width:60px; font-weight:600; color:var(--fg2); }
.slider-group input[type=range] { flex:1; min-width:120px; accent-color:var(--accent); }
.slider-group .val { min-width:70px; text-align:right; font-family:monospace; color:var(--accent2); }
button { padding:.5rem 1.2rem; background:var(--accent); color:#fff; border:none; border-radius:var(--radius); cursor:pointer; font-size:1rem; font-weight:600; transition:background .2s; }
button:hover { background:var(--accent2); color:var(--bg); }
button.secondary { background:var(--bg3); color:var(--fg2); border:1px solid var(--fg2); }
button.secondary:hover { border-color:var(--accent); color:var(--accent); }
.result { margin:1rem 0; padding:.8rem 1rem; border-radius:var(--radius); font-family:monospace; font-size:1rem; display:none; }
.result.show { display:block; }
.result.ok { background:#1b3a1b; border:1px solid var(--ok); color:var(--ok); }
.result.err { background:#3a1b1b; border:1px solid var(--err); color:var(--err); }
.result.info { background:var(--bg3); border:1px solid var(--fg2); color:var(--fg); }
.result-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(200px,1fr)); gap:.5rem; }
.result-grid .item { background:var(--bg2); padding:.5rem .8rem; border-radius:var(--radius); }
.result-grid .item .lbl { font-size:.8rem; color:var(--fg2); }
.result-grid .item .val { font-size:1.1rem; color:var(--accent2); font-family:monospace; }
/* SVG */
svg.circuit { width:100%; max-width:500px; display:block; margin:1rem auto; }
svg.circuit text { fill:var(--fg); font-family:'Segoe UI',system-ui,sans-serif; font-size:14px; }
svg.circuit .wire { stroke:var(--fg2); stroke-width:2; fill:none; }
svg.circuit .resistor { stroke:var(--accent2); stroke-width:2.5; fill:none; }
svg.circuit .source { stroke:var(--warn); stroke-width:2.5; fill:none; }
svg.circuit .node-dot { fill:var(--accent); }
svg.circuit .arrow { fill:var(--accent); stroke:none; }
svg.circuit .current-dot { fill:var(--warn); }
/* flow animation */
@keyframes flowRight { from{stroke-dashoffset:20} to{stroke-dashoffset:0} }
@keyframes flowLeft { from{stroke-dashoffset:-20} to{stroke-dashoffset:0} }
svg.circuit .flow { stroke-dasharray:4 16; stroke-width:3; stroke:var(--warn); opacity:.6; animation: flowRight 1s linear infinite; }
/* TABLES */
table.eq-table { border-collapse:collapse; margin:.8rem 0; width:100%; }
table.eq-table th, table.eq-table td { border:1px solid var(--bg3); padding:.4rem .6rem; text-align:center; }
table.eq-table th { background:var(--bg3); color:var(--accent2); font-weight:600; }
table.eq-table input { width:70px; padding:.3rem; background:var(--bg); border:1px solid var(--fg2); color:var(--fg); border-radius:4px; text-align:center; font-size:.95rem; }
table.eq-table input:focus { border-color:var(--accent); outline:none; }
table.eq-table input.ok { border-color:var(--ok); background:#1b3a1b; }
table.eq-table input.err { border-color:var(--err); background:#3a1b1b; }
/* interactive step */
.step-box { background:var(--bg2); border:1px solid var(--bg3); border-radius:var(--radius); padding:1rem; margin:.8rem 0; }
.step-box.current { border-color:var(--accent); }
.step-box h4 { color:var(--accent); margin-bottom:.4rem; }
.choice-btns { display:flex; flex-wrap:wrap; gap:.5rem; margin:.5rem 0; }
.choice-btns button { font-size:.9rem; padding:.4rem .8rem; }
.choice-btns button.selected { background:var(--accent2); color:var(--bg); }
/* highlight for SVG interactive */
.highlight { stroke:var(--warn)!important; stroke-width:3.5!important; }
.highlight-fill { fill:var(--warn)!important; opacity:.3; }
/* CAS box */
.cas-box { background:#1a1a2e; border:1px solid #5c6bc0; border-radius:var(--radius); padding:.8rem 1rem; margin:.8rem 0; font-family:monospace; color:#9fa8da; white-space:pre-wrap; font-size:.9rem; }
.cas-box .cas-label { color:#5c6bc0; font-weight:700; font-family:sans-serif; font-size:.8rem; margin-bottom:.3rem; }
/* RESPONSIVE */
@media(max-width:800px){
  nav { transform:translateX(-260px); }
  nav.open { transform:translateX(0); }
  .nav-toggle { display:block; }
  main { margin-left:0; padding:1rem; }
}
/* Kirchhoff node/mesh selector */
.node-sel, .mesh-sel { display:inline-block; padding:.3rem .7rem; margin:.2rem; border:2px solid var(--fg2); border-radius:var(--radius); cursor:pointer; transition:all .2s; }
.node-sel:hover, .mesh-sel:hover { border-color:var(--accent); }
.node-sel.active, .mesh-sel.active { border-color:var(--accent); background:var(--accent); color:#fff; }
/* Equation input row */
.eq-row { display:flex; align-items:center; gap:.4rem; margin:.5rem 0; flex-wrap:wrap; font-family:monospace; font-size:1.05rem; }
.eq-row input { width:60px; }
.eq-row span { color:var(--fg2); }
</style>
</head>
<body>
<button class="nav-toggle" onclick="document.querySelector('nav').classList.toggle('open')" aria-label="Men√º">‚ò∞</button>
<nav id="nav">
  <h1>‚ö° Kirchhoff-Workshop</h1>
  <a href="#" data-ch="0" class="active"><span class="ch-num">1</span> Parallelschaltung <span class="ch-check">‚úì</span></a>
  <a href="#" data-ch="1"><span class="ch-num">2</span> Gemischte Schaltung <span class="ch-check">‚úì</span></a>
  <a href="#" data-ch="2"><span class="ch-num">3</span> Wheatstone-Br√ºcke <span class="ch-check">‚úì</span></a>
  <a href="#" data-ch="3"><span class="ch-num">4</span> Kirchhoff'sche Regeln <span class="ch-check">‚úì</span></a>
  <a href="#" data-ch="4"><span class="ch-num">5</span> Gleichungssystem <span class="ch-check">‚úì</span></a>
  <a href="#" data-ch="5"><span class="ch-num">6</span> Freier Rechner <span class="ch-check">‚úì</span></a>
  <div class="progress-wrap">
    <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
    <div class="progress-label" id="progressLabel">0 / 6 abgeschlossen</div>
  </div>
</nav>

<main>
<!-- ===== KAPITEL 1: PARALLELSCHALTUNG ===== -->
<section id="ch0" class="active">
<h2>1 ¬∑ Parallelschaltung</h2>
<div class="theory">
  <h3>Formel</h3>
  <div class="formula">1/R<sub>ges</sub> = 1/R‚ÇÅ + 1/R‚ÇÇ + 1/R‚ÇÉ</div>
  <p>Bei der Parallelschaltung liegt an allen Widerst√§nden die <strong>gleiche Spannung</strong> an. Die Str√∂me teilen sich auf.</p>
</div>

<svg class="circuit" viewBox="0 0 440 220" id="svg-parallel">
  <!-- Wires -->
  <line x1="30" y1="110" x2="100" y2="110" class="wire"/>
  <line x1="100" y1="40" x2="100" y2="180" class="wire"/>
  <line x1="340" y1="40" x2="340" y2="180" class="wire"/>
  <line x1="340" y1="110" x2="410" y2="110" class="wire"/>
  <!-- R1 -->
  <line x1="100" y1="40" x2="160" y2="40" class="wire"/>
  <line x1="160.0" y1="40.0" x2="180.0" y2="40.0" class="wire"/><line x1="240.0" y1="40.0" x2="260.0" y2="40.0" class="wire"/><polygon points="180.0,48.0 240.0,48.0 240.0,32.0 180.0,32.0" fill="none" stroke="var(--accent2)" stroke-width="2.5"/>
  <line x1="260" y1="40" x2="340" y2="40" class="wire"/>
  <text x="210" y="18" text-anchor="middle" id="par-r1-label">R‚ÇÅ = 100 Œ©</text>
  <!-- R2 -->
  <line x1="100" y1="110" x2="160" y2="110" class="wire"/>
  <line x1="160.0" y1="110.0" x2="180.0" y2="110.0" class="wire"/><line x1="240.0" y1="110.0" x2="260.0" y2="110.0" class="wire"/><polygon points="180.0,118.0 240.0,118.0 240.0,102.0 180.0,102.0" fill="none" stroke="var(--accent2)" stroke-width="2.5"/>
  <line x1="260" y1="110" x2="340" y2="110" class="wire"/>
  <text x="210" y="145" text-anchor="middle" id="par-r2-label">R‚ÇÇ = 220 Œ©</text>
  <!-- R3 -->
  <line x1="100" y1="180" x2="160" y2="180" class="wire"/>
  <line x1="160.0" y1="180.0" x2="180.0" y2="180.0" class="wire"/><line x1="240.0" y1="180.0" x2="260.0" y2="180.0" class="wire"/><polygon points="180.0,188.0 240.0,188.0 240.0,172.0 180.0,172.0" fill="none" stroke="var(--accent2)" stroke-width="2.5"/>
  <line x1="260" y1="180" x2="340" y2="180" class="wire"/>
  <text x="210" y="210" text-anchor="middle" id="par-r3-label">R‚ÇÉ = 330 Œ©</text>
  <!-- Flow lines -->
  <line x1="100" y1="40" x2="340" y2="40" class="flow" style="opacity:0" id="par-flow1"/>
  <line x1="100" y1="110" x2="340" y2="110" class="flow" style="opacity:0" id="par-flow2"/>
  <line x1="100" y1="180" x2="340" y2="180" class="flow" style="opacity:0" id="par-flow3"/>
  <!-- Nodes -->
  <circle cx="100" cy="110" r="5" class="node-dot"/>
  <circle cx="340" cy="110" r="5" class="node-dot"/>
  <text x="20" y="115" text-anchor="middle" fill="#ffa726" font-weight="700">+</text>
  <text x="420" y="115" text-anchor="middle" fill="#ffa726" font-weight="700">‚àí</text>
</svg>

<h3>Werte einstellen</h3>
<div class="slider-group">
  <label>R‚ÇÅ:</label>
  <input type="range" min="10" max="1000" value="100" step="10" id="par-r1" oninput="parCalc()">
  <span class="val" id="par-r1-val">100 Œ©</span>
</div>
<div class="slider-group">
  <label>R‚ÇÇ:</label>
  <input type="range" min="10" max="1000" value="220" step="10" id="par-r2" oninput="parCalc()">
  <span class="val" id="par-r2-val">220 Œ©</span>
</div>
<div class="slider-group">
  <label>R‚ÇÉ:</label>
  <input type="range" min="10" max="1000" value="330" step="10" id="par-r3" oninput="parCalc()">
  <span class="val" id="par-r3-val">330 Œ©</span>
</div>
<div class="slider-group">
  <label>U:</label>
  <input type="range" min="1" max="30" value="12" step="0.5" id="par-u" oninput="parCalc()">
  <span class="val" id="par-u-val">12 V</span>
</div>

<div class="result info show" id="par-result">
  <div class="result-grid" id="par-result-grid"></div>
</div>

<h3>√úbungsaufgabe</h3>
<p>R‚ÇÅ = 150 Œ©, R‚ÇÇ = 300 Œ© parallel. Wie gro√ü ist R<sub>ges</sub>?</p>
<div class="input-group">
  <label>R<sub>ges</sub> =</label>
  <input type="number" id="par-quiz" step="1">
  <span class="unit">Œ©</span>
  <button onclick="parCheck()">Pr√ºfen</button>
</div>
<div class="result" id="par-quiz-result"></div>
</section>

<!-- ===== KAPITEL 2: GEMISCHTE SCHALTUNG ===== -->
<section id="ch1">
<h2>2 ¬∑ Gemischte Schaltungen</h2>
<div class="theory">
  <p>Gemischte Schaltungen enthalten sowohl <strong>Reihen-</strong> als auch <strong>Parallelschaltungen</strong>. Man vereinfacht schrittweise von innen nach au√üen.</p>
</div>

<svg class="circuit" viewBox="0 0 480 200" id="svg-mixed">
  <!-- Source -->
  <line x1="30" y1="100" x2="80" y2="100" class="wire"/>
  <!-- R1 in series -->
  <line x1="80.0" y1="100.0" x2="96.0" y2="100.0" class="wire"/><line x1="144.0" y1="100.0" x2="160.0" y2="100.0" class="wire"/><polygon points="96.0,108.0 144.0,108.0 144.0,92.0 96.0,92.0" fill="none" stroke="var(--accent2)" stroke-width="2.5"/>
  <text x="120" y="75" text-anchor="middle" id="mix-r1-text">R‚ÇÅ = 100 Œ©</text>
  <line x1="160" y1="100" x2="200" y2="100" class="wire"/>
  <!-- Split -->
  <line x1="200" y1="50" x2="200" y2="150" class="wire"/>
  <!-- R2 top -->
  <line x1="200" y1="50" x2="240" y2="50" class="wire"/>
  <line x1="240.0" y1="50.0" x2="256.0" y2="50.0" class="wire"/><line x1="304.0" y1="50.0" x2="320.0" y2="50.0" class="wire"/><polygon points="256.0,58.0 304.0,58.0 304.0,42.0 256.0,42.0" fill="none" stroke="var(--accent2)" stroke-width="2.5"/>
  <line x1="320" y1="50" x2="380" y2="50" class="wire"/>
  <text x="280" y="30" text-anchor="middle" id="mix-r2-text">R‚ÇÇ = 220 Œ©</text>
  <!-- R3 bottom -->
  <line x1="200" y1="150" x2="240" y2="150" class="wire"/>
  <line x1="240.0" y1="150.0" x2="256.0" y2="150.0" class="wire"/><line x1="304.0" y1="150.0" x2="320.0" y2="150.0" class="wire"/><polygon points="256.0,158.0 304.0,158.0 304.0,142.0 256.0,142.0" fill="none" stroke="var(--accent2)" stroke-width="2.5"/>
  <line x1="320" y1="150" x2="380" y2="150" class="wire"/>
  <text x="280" y="175" text-anchor="middle" id="mix-r3-text">R‚ÇÉ = 330 Œ©</text>
  <!-- Merge -->
  <line x1="380" y1="50" x2="380" y2="150" class="wire"/>
  <line x1="380" y1="100" x2="450" y2="100" class="wire"/>
  <!-- Nodes -->
  <circle cx="200" cy="100" r="5" class="node-dot"/>
  <circle cx="380" cy="100" r="5" class="node-dot"/>
</svg>

<h3>Schritt-f√ºr-Schritt Vereinfachung</h3>
<div class="step-box current" id="mix-step1">
  <h4>Schritt 1: Welche Widerst√§nde liegen parallel?</h4>
  <div class="choice-btns">
    <button onclick="mixChoice(1,'r1r2')">R‚ÇÅ ‚à• R‚ÇÇ</button>
    <button onclick="mixChoice(1,'r2r3')">R‚ÇÇ ‚à• R‚ÇÉ</button>
    <button onclick="mixChoice(1,'r1r3')">R‚ÇÅ ‚à• R‚ÇÉ</button>
  </div>
  <div class="result" id="mix-step1-result"></div>
</div>
<div class="step-box" id="mix-step2" style="opacity:.4">
  <h4>Schritt 2: Berechne R‚ÇÇ‚ÇÉ = R‚ÇÇ ‚à• R‚ÇÉ</h4>
  <div class="input-group">
    <label>R‚ÇÇ‚ÇÉ =</label>
    <input type="number" id="mix-r23" step="0.1">
    <span class="unit">Œ©</span>
    <button onclick="mixCheck2()">Pr√ºfen</button>
  </div>
  <div class="result" id="mix-step2-result"></div>
</div>
<div class="step-box" id="mix-step3" style="opacity:.4">
  <h4>Schritt 3: R<sub>ges</sub> = R‚ÇÅ + R‚ÇÇ‚ÇÉ (Reihenschaltung)</h4>
  <div class="input-group">
    <label>R<sub>ges</sub> =</label>
    <input type="number" id="mix-rges" step="0.1">
    <span class="unit">Œ©</span>
    <button onclick="mixCheck3()">Pr√ºfen</button>
  </div>
  <div class="result" id="mix-step3-result"></div>
</div>
</section>

<!-- ===== KAPITEL 3: WHEATSTONE-BR√úCKE ===== -->
<section id="ch2">
<h2>3 ¬∑ Wheatstone-Br√ºcke</h2>
<div class="theory">
  <p>Die Wheatstone-Br√ºcke besteht aus <strong>vier Widerst√§nden</strong> in einer Br√ºcken-(Diamant-)Anordnung und einem <strong>Br√ºckenwiderstand R‚ÇÖ</strong> zwischen den Mittelpunkten.</p>
  <div class="formula">Diese Schaltung l√§sst sich <strong>NICHT</strong> durch Reihen-/Parallelschaltung vereinfachen!</div>
</div>

<svg class="circuit" viewBox="0 0 400 360" id="svg-wheatstone">
  <defs><marker id="arw" viewBox="0 0 10 10" refX="10" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="#ffa726"/></marker></defs>
  <!-- R1: A to B -->
  <line x1="200" y1="30" x2="155" y2="77" class="wire"/>
  <polygon points="147,70 98,121 113,135 162,84" fill="none" stroke="var(--accent2)" stroke-width="2.5"/>
  <line x1="106" y1="128" x2="60" y2="175" class="wire"/>
  <text x="108" y="84" text-anchor="end" fill="#81c784" font-weight="600" font-size="15">R‚ÇÅ</text>
  <line x1="172" y1="59" x2="164" y2="68" stroke="#ffa726" stroke-width="2" marker-end="url(#arw)"/>
  <text x="158" y="50" text-anchor="middle" fill="#ffa726" font-size="12">I‚ÇÅ</text>
  <!-- R2: A to C -->
  <line x1="200" y1="30" x2="246" y2="77" class="wire"/>
  <polygon points="238,84 288,135 302,121 253,70" fill="none" stroke="var(--accent2)" stroke-width="2.5"/>
  <line x1="295" y1="128" x2="340" y2="175" class="wire"/>
  <text x="292" y="84" text-anchor="start" fill="#81c784" font-weight="600" font-size="15">R‚ÇÇ</text>
  <line x1="228" y1="59" x2="236" y2="68" stroke="#ffa726" stroke-width="2" marker-end="url(#arw)"/>
  <text x="242" y="50" text-anchor="middle" fill="#ffa726" font-size="12">I‚ÇÇ</text>
  <!-- R3: B to D -->
  <line x1="60" y1="175" x2="106" y2="222" class="wire"/>
  <polygon points="98,229 147,280 162,266 113,215" fill="none" stroke="var(--accent2)" stroke-width="2.5"/>
  <line x1="155" y1="273" x2="200" y2="320" class="wire"/>
  <text x="108" y="266" text-anchor="end" fill="#81c784" font-weight="600" font-size="15">R‚ÇÉ</text>
  <line x1="88" y1="204" x2="96" y2="213" stroke="#ffa726" stroke-width="2" marker-end="url(#arw)"/>
  <text x="73" y="214" text-anchor="middle" fill="#ffa726" font-size="12">I‚ÇÉ</text>
  <!-- R4: C to D -->
  <line x1="340" y1="175" x2="295" y2="222" class="wire"/>
  <polygon points="287,215 238,266 253,280 302,229" fill="none" stroke="var(--accent2)" stroke-width="2.5"/>
  <line x1="246" y1="273" x2="200" y2="320" class="wire"/>
  <text x="292" y="266" text-anchor="start" fill="#81c784" font-weight="600" font-size="15">R‚ÇÑ</text>
  <line x1="312" y1="204" x2="304" y2="213" stroke="#ffa726" stroke-width="2" marker-end="url(#arw)"/>
  <text x="327" y="214" text-anchor="middle" fill="#ffa726" font-size="12">I‚ÇÑ</text>
  <!-- R5: B to C (bridge) -->
  <line x1="60" y1="175" x2="151" y2="175" class="wire"/>
  <rect x="151" y="165" width="98" height="20" fill="none" stroke="var(--warn)" stroke-width="2.5"/>
  <line x1="249" y1="175" x2="340" y2="175" class="wire"/>
  <text x="200" y="158" text-anchor="middle" fill="#ffa726" font-weight="700" font-size="15">R‚ÇÖ</text>
  <line x1="108" y1="175" x2="120" y2="175" stroke="#ffa726" stroke-width="2" marker-end="url(#arw)"/>
  <text x="114" y="165" text-anchor="middle" fill="#ffa726" font-size="12">I‚ÇÖ</text>
  <!-- Nodes -->
  <circle cx="200" cy="30" r="5" class="node-dot"/>
  <text x="200" y="15" text-anchor="middle" fill="#4caf50" font-weight="700" font-size="16">A</text>
  <circle cx="60" cy="175" r="5" class="node-dot"/>
  <text x="38" y="180" text-anchor="end" fill="#4caf50" font-weight="700" font-size="16">B</text>
  <circle cx="340" cy="175" r="5" class="node-dot"/>
  <text x="362" y="180" text-anchor="start" fill="#4caf50" font-weight="700" font-size="16">C</text>
  <circle cx="200" cy="320" r="5" class="node-dot"/>
  <text x="200" y="342" text-anchor="middle" fill="#4caf50" font-weight="700" font-size="16">D</text>
  <text x="200" y="8" text-anchor="middle" fill="#ffa726" font-size="13">+ U‚ÇÄ ‚àí</text>
</svg>

<h3>Warum geht Reihe/Parallel nicht?</h3>
<ul>
  <li>R‚ÇÅ und R‚ÇÉ liegen <strong>nicht einfach in Reihe</strong>, weil am Knoten B ein Strom √ºber R‚ÇÖ abflie√üt.</li>
  <li>R‚ÇÅ und R‚ÇÇ liegen <strong>nicht parallel</strong>, weil sie verschiedene Endknoten haben (B vs. C).</li>
  <li>Der Br√ºckenwiderstand R‚ÇÖ verbindet die beiden Zweige ‚Üí <strong>keine einfache Zerlegung m√∂glich</strong>.</li>
</ul>

<h3>Abgeglichene Br√ºcke</h3>
<div class="theory">
  <div class="formula">R‚ÇÅ ¬∑ R‚ÇÑ = R‚ÇÇ ¬∑ R‚ÇÉ ‚üπ I‚ÇÖ = 0, U<sub>BC</sub> = 0</div>
  <p>Wenn die Br√ºcke <strong>abgeglichen</strong> ist, flie√üt kein Strom durch R‚ÇÖ. Dann darf man Reihen-/Parallel-Vereinfachung nutzen:</p>
  <div class="formula">R<sub>ges</sub> = (R‚ÇÅ+R‚ÇÉ) ‚à• (R‚ÇÇ+R‚ÇÑ)</div>
</div>

<h3>Ist unsere Br√ºcke abgeglichen?</h3>
<div class="input-group">
  <span>R‚ÇÅ¬∑R‚ÇÑ = 100¬∑470 = <strong>47.000</strong></span>
</div>
<div class="input-group">
  <span>R‚ÇÇ¬∑R‚ÇÉ = 220¬∑330 = <strong>72.600</strong></span>
</div>
<div class="result info show">47.000 ‚â† 72.600 ‚Üí Die Br√ºcke ist <strong>nicht abgeglichen</strong>. Wir brauchen Kirchhoff!</div>

<h3>Quiz</h3>
<p>Wann ist eine Wheatstone-Br√ºcke abgeglichen?</p>
<div class="choice-btns">
  <button onclick="wheatQuiz(this,false)">R‚ÇÅ + R‚ÇÑ = R‚ÇÇ + R‚ÇÉ</button>
  <button onclick="wheatQuiz(this,true)">R‚ÇÅ ¬∑ R‚ÇÑ = R‚ÇÇ ¬∑ R‚ÇÉ</button>
  <button onclick="wheatQuiz(this,false)">R‚ÇÅ = R‚ÇÇ = R‚ÇÉ = R‚ÇÑ</button>
</div>
<div class="result" id="wheat-quiz-result"></div>
</section>

<!-- ===== KAPITEL 4: KIRCHHOFF ===== -->
<section id="ch3">
<h2>4 ¬∑ Kirchhoff'sche Regeln</h2>

<div class="theory">
  <h3>1. Knotenregel (KCL)</h3>
  <div class="formula">‚àë I<sub>zu</sub> = ‚àë I<sub>ab</sub> &nbsp;(bzw. ‚àë I = 0 mit Vorzeichen)</div>
  <h3 style="margin-top:.8rem">2. Maschenregel (KVL)</h3>
  <div class="formula">‚àë U = 0 &nbsp;(Umlauf in einer geschlossenen Masche)</div>
</div>

<div class="warn-box">
  <strong>‚ö†Ô∏è H√§ufiger Fehler: Vorzeichenkonvention!</strong><br>
  Lege <strong>zuerst</strong> alle Stromrichtungen fest (beliebig, aber dann <strong>konsistent</strong> bleiben!). Wenn das Ergebnis negativ wird, flie√üt der Strom eben andersrum. Das ist kein Fehler!<br><br>
  <strong>Typischer Fehler:</strong> Stromrichtung in der Knotengleichung anders definieren als in der Maschengleichung ‚Üí Widerspruch!
</div>

<h3>Unsere Stromrichtungen (Konvention)</h3>
<p>Wir definieren f√ºr die Wheatstone-Br√ºcke:</p>
<ul>
  <li><strong>I‚ÇÅ</strong>: A ‚Üí B (durch R‚ÇÅ)</li>
  <li><strong>I‚ÇÇ</strong>: A ‚Üí C (durch R‚ÇÇ)</li>
  <li><strong>I‚ÇÉ</strong>: B ‚Üí D (durch R‚ÇÉ)</li>
  <li><strong>I‚ÇÑ</strong>: C ‚Üí D (durch R‚ÇÑ)</li>
  <li><strong>I‚ÇÖ</strong>: B ‚Üí C (durch R‚ÇÖ) &nbsp;‚Üê <em>konsistent festgelegt!</em></li>
</ul>

<h3>Knotenregel anwenden</h3>
<p>W√§hle einen Knoten und trage die Gleichung ein:</p>
<div style="margin:.5rem 0">
  <span class="node-sel active" onclick="selNode(this,'A')" id="node-A">A</span>
  <span class="node-sel" onclick="selNode(this,'B')" id="node-B">B</span>
  <span class="node-sel" onclick="selNode(this,'C')" id="node-C">C</span>
  <span class="node-sel" onclick="selNode(this,'D')" id="node-D">D</span>
</div>
<div id="node-hint" class="theory" style="font-size:.9rem"></div>
<p style="margin-top:.5rem">Trage die Knotengleichung ein (z.B. <code>I1+I2=I0</code> oder <code>I1-I3-I5=0</code>):</p>
<div class="input-group">
  <input type="text" id="node-eq" style="width:250px;text-align:left" placeholder="z.B. I1-I3-I5=0">
  <button onclick="checkNodeEq()">Pr√ºfen</button>
</div>
<div class="result" id="node-eq-result"></div>

<h3>Maschenregel anwenden</h3>
<p>W√§hle eine Masche:</p>
<div style="margin:.5rem 0">
  <span class="mesh-sel active" onclick="selMesh(this,'M1')" id="mesh-M1">M1: A‚ÜíB‚ÜíD‚ÜíA</span>
  <span class="mesh-sel" onclick="selMesh(this,'M2')" id="mesh-M2">M2: A‚ÜíC‚ÜíD‚ÜíA</span>
  <span class="mesh-sel" onclick="selMesh(this,'M3')" id="mesh-M3">M3: B‚ÜíC‚ÜíD‚ÜíB</span>
</div>
<div id="mesh-hint" class="theory" style="font-size:.9rem"></div>
<p style="margin-top:.5rem">Trage die Maschengleichung ein (z.B. <code>U0-R1*I1-R3*I3=0</code>):</p>
<div class="input-group">
  <input type="text" id="mesh-eq" style="width:300px;text-align:left" placeholder="z.B. U0-R1*I1-R3*I3=0">
  <button onclick="checkMeshEq()">Pr√ºfen</button>
</div>
<div class="result" id="mesh-eq-result"></div>

<h3>Vorzeichenkonvention ‚Äì √úbung</h3>
<p>Gegeben: Am Knoten B gilt I‚ÇÅ = I‚ÇÉ + I‚ÇÖ. In Masche M3 (B‚ÜíC‚ÜíD‚ÜíB) kommt R‚ÇÖ vor.</p>
<p><strong>Frage:</strong> Welches Vorzeichen hat R‚ÇÖ¬∑I‚ÇÖ in Masche M3 (Umlaufrichtung B‚ÜíC)?</p>
<div class="choice-btns">
  <button onclick="signQuiz(this,false)">+R‚ÇÖ¬∑I‚ÇÖ (positiv)</button>
  <button onclick="signQuiz(this,true)">‚àíR‚ÇÖ¬∑I‚ÇÖ (negativ)</button>
</div>
<div class="result" id="sign-quiz-result"></div>
<div class="result info" id="sign-explain" style="display:none">
  <strong>Erkl√§rung:</strong> I‚ÇÖ flie√üt B‚ÜíC. Die Masche M3 geht B‚ÜíC‚ÜíD‚ÜíB. Im Abschnitt B‚ÜíC ist die Umlaufrichtung <em>gleich</em> der Stromrichtung. Also ist der Spannungsabfall +R‚ÇÖ¬∑I‚ÇÖ. Aber die Maschengleichung hei√üt ‚àëU=0, d.h. wir subtrahieren Spannungsabf√§lle:<br>
  <strong>‚àíR‚ÇÖ¬∑I‚ÇÖ ‚àí R‚ÇÑ¬∑I‚ÇÑ + R‚ÇÉ¬∑I‚ÇÉ = 0</strong><br>
  Alternativ: <strong>R‚ÇÖ¬∑I‚ÇÖ + R‚ÇÑ¬∑I‚ÇÑ = R‚ÇÉ¬∑I‚ÇÉ</strong><br><br>
  Achtung: Je nach Umlaufrichtung √§ndert sich das Vorzeichen. Entscheidend ist die <strong>Konsistenz</strong>!
</div>
</section>

<!-- ===== KAPITEL 5: GLEICHUNGSSYSTEM ===== -->
<section id="ch4">
<h2>5 ¬∑ Gleichungssystem aufstellen & l√∂sen</h2>

<div class="theory">
  <p>F√ºr die Wheatstone-Br√ºcke mit 5 unbekannten Str√∂men (I‚ÇÅ..I‚ÇÖ) brauchen wir <strong>5 Gleichungen</strong>:</p>
  <ul>
    <li>2 Knotengleichungen (z.B. Knoten B und C)</li>
    <li>3 Maschengleichungen (z.B. M1, M2, M3)</li>
  </ul>
  <p>Aber: Nur 2 Knoten + 2 Maschen + 1 weitere Beziehung sind unabh√§ngig. Wir verwenden 3 Maschen (eine ist redundant als Check).</p>
</div>

<h3>Die 5 Gleichungen (Default-Werte)</h3>
<div class="theory" style="font-family:monospace;font-size:1rem;line-height:1.8">
  <strong>Knoten A:</strong> I‚ÇÄ = I‚ÇÅ + I‚ÇÇ<br>
  <strong>Knoten B:</strong> I‚ÇÅ = I‚ÇÉ + I‚ÇÖ<br>
  <strong>Knoten C:</strong> I‚ÇÇ + I‚ÇÖ = I‚ÇÑ &nbsp;(bzw. I‚ÇÇ ‚àí I‚ÇÑ + I‚ÇÖ = 0)<br>
  <strong>Masche M1 (A-B-D-A):</strong> U‚ÇÄ = R‚ÇÅ¬∑I‚ÇÅ + R‚ÇÉ¬∑I‚ÇÉ<br>
  <strong>Masche M2 (A-C-D-A):</strong> U‚ÇÄ = R‚ÇÇ¬∑I‚ÇÇ + R‚ÇÑ¬∑I‚ÇÑ<br>
  <strong>Masche M3 (B-C-D-B):</strong> R‚ÇÖ¬∑I‚ÇÖ + R‚ÇÑ¬∑I‚ÇÑ ‚àí R‚ÇÉ¬∑I‚ÇÉ = 0
</div>

<h3>Koeffizienten-Matrix eingeben</h3>
<p>Trage die Koeffizienten ein. Format: <code>a‚ÇÅ¬∑I‚ÇÅ + a‚ÇÇ¬∑I‚ÇÇ + a‚ÇÉ¬∑I‚ÇÉ + a‚ÇÑ¬∑I‚ÇÑ + a‚ÇÖ¬∑I‚ÇÖ = b</code></p>
<table class="eq-table" id="eq-table">
  <tr><th></th><th>I‚ÇÅ</th><th>I‚ÇÇ</th><th>I‚ÇÉ</th><th>I‚ÇÑ</th><th>I‚ÇÖ</th><th>=</th><th>b</th></tr>
  <tr><td>Knoten B</td><td><input id="eq00" value="1"></td><td><input id="eq01" value="0"></td><td><input id="eq02" value="-1"></td><td><input id="eq03" value="0"></td><td><input id="eq04" value="-1"></td><td>=</td><td><input id="eq05" value="0"></td></tr>
  <tr><td>Knoten C</td><td><input id="eq10" value="0"></td><td><input id="eq11" value="1"></td><td><input id="eq12" value="0"></td><td><input id="eq13" value="-1"></td><td><input id="eq14" value="1"></td><td>=</td><td><input id="eq15" value="0"></td></tr>
  <tr><td>Masche 1</td><td><input id="eq20" value="100"></td><td><input id="eq21" value="0"></td><td><input id="eq22" value="330"></td><td><input id="eq23" value="0"></td><td><input id="eq24" value="0"></td><td>=</td><td><input id="eq25" value="12"></td></tr>
  <tr><td>Masche 2</td><td><input id="eq30" value="0"></td><td><input id="eq31" value="220"></td><td><input id="eq32" value="0"></td><td><input id="eq33" value="470"></td><td><input id="eq34" value="0"></td><td>=</td><td><input id="eq35" value="12"></td></tr>
  <tr><td>Masche 3</td><td><input id="eq40" value="0"></td><td><input id="eq41" value="0"></td><td><input id="eq42" value="-330"></td><td><input id="eq43" value="470"></td><td><input id="eq44" value="150"></td><td>=</td><td><input id="eq45" value="0"></td></tr>
</table>

<div style="display:flex;gap:.5rem;flex-wrap:wrap;margin:.8rem 0">
  <button onclick="checkEqSystem()">Gleichungen pr√ºfen</button>
  <button onclick="solveSystem()" class="secondary">L√∂sen (Gau√ü)</button>
  <button onclick="showCAS()" class="secondary">ClassPad Syntax</button>
</div>

<div class="result" id="eq-check-result"></div>
<div class="result" id="eq-solve-result"></div>

<div class="cas-box" style="display:none" id="cas-box">
  <div class="cas-label">üì± ClassPad CAS Eingabe:</div>
solve({
  I1-I3-I5=0,
  I2-I4+I5=0,
  100*I1+330*I3=12,
  220*I2+470*I4=12,
  -330*I3+470*I4+150*I5=0
},{I1,I2,I3,I4,I5})
</div>
</section>

<!-- ===== KAPITEL 6: FREIER RECHNER ===== -->
<section id="ch5">
<h2>6 ¬∑ Freier Rechner</h2>

<div class="theory">
  <p>Gib eigene Werte ein und berechne sofort alle Str√∂me, Spannungen und R<sub>ges</sub> der Wheatstone-Br√ºcke.</p>
</div>

<svg class="circuit" viewBox="0 0 400 360" id="svg-calc">
  <defs><marker id="arw2" viewBox="0 0 10 10" refX="10" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="#ffa726"/></marker></defs>
  <!-- R1: A to B -->
  <line x1="200" y1="30" x2="155" y2="77" class="wire"/>
  <polygon points="147,70 98,121 113,135 162,84" fill="none" stroke="var(--accent2)" stroke-width="2.5"/>
  <line x1="106" y1="128" x2="60" y2="175" class="wire"/>
  <text x="108" y="84" text-anchor="end" fill="#81c784" font-weight="600" font-size="15" id="calc-r1-label">R‚ÇÅ</text>
  <line x1="172" y1="59" x2="164" y2="68" stroke="#ffa726" stroke-width="2" marker-end="url(#arw2)"/>
  <text x="158" y="50" text-anchor="middle" fill="#ffa726" font-size="12" id="calc-i1-svg">I‚ÇÅ</text>
  <!-- R2: A to C -->
  <line x1="200" y1="30" x2="246" y2="77" class="wire"/>
  <polygon points="238,84 288,135 302,121 253,70" fill="none" stroke="var(--accent2)" stroke-width="2.5"/>
  <line x1="295" y1="128" x2="340" y2="175" class="wire"/>
  <text x="292" y="84" text-anchor="start" fill="#81c784" font-weight="600" font-size="15" id="calc-r2-label">R‚ÇÇ</text>
  <line x1="228" y1="59" x2="236" y2="68" stroke="#ffa726" stroke-width="2" marker-end="url(#arw2)"/>
  <text x="242" y="50" text-anchor="middle" fill="#ffa726" font-size="12" id="calc-i2-svg">I‚ÇÇ</text>
  <!-- R3: B to D -->
  <line x1="60" y1="175" x2="106" y2="222" class="wire"/>
  <polygon points="98,229 147,280 162,266 113,215" fill="none" stroke="var(--accent2)" stroke-width="2.5"/>
  <line x1="155" y1="273" x2="200" y2="320" class="wire"/>
  <text x="108" y="266" text-anchor="end" fill="#81c784" font-weight="600" font-size="15" id="calc-r3-label">R‚ÇÉ</text>
  <line x1="88" y1="204" x2="96" y2="213" stroke="#ffa726" stroke-width="2" marker-end="url(#arw2)"/>
  <text x="73" y="214" text-anchor="middle" fill="#ffa726" font-size="12" id="calc-i3-svg">I‚ÇÉ</text>
  <!-- R4: C to D -->
  <line x1="340" y1="175" x2="295" y2="222" class="wire"/>
  <polygon points="287,215 238,266 253,280 302,229" fill="none" stroke="var(--accent2)" stroke-width="2.5"/>
  <line x1="246" y1="273" x2="200" y2="320" class="wire"/>
  <text x="292" y="266" text-anchor="start" fill="#81c784" font-weight="600" font-size="15" id="calc-r4-label">R‚ÇÑ</text>
  <line x1="312" y1="204" x2="304" y2="213" stroke="#ffa726" stroke-width="2" marker-end="url(#arw2)"/>
  <text x="327" y="214" text-anchor="middle" fill="#ffa726" font-size="12" id="calc-i4-svg">I‚ÇÑ</text>
  <!-- R5: B to C (bridge) -->
  <line x1="60" y1="175" x2="151" y2="175" class="wire"/>
  <rect x="151" y="165" width="98" height="20" fill="none" stroke="var(--warn)" stroke-width="2.5"/>
  <line x1="249" y1="175" x2="340" y2="175" class="wire"/>
  <text x="200" y="158" text-anchor="middle" fill="#ffa726" font-weight="700" font-size="15" id="calc-r5-label">R‚ÇÖ</text>
  <line x1="108" y1="175" x2="120" y2="175" stroke="#ffa726" stroke-width="2" marker-end="url(#arw2)"/>
  <text x="114" y="165" text-anchor="middle" fill="#ffa726" font-size="12" id="calc-i5-svg">I‚ÇÖ</text>
  <!-- Nodes -->
  <circle cx="200" cy="30" r="5" class="node-dot"/>
  <text x="200" y="15" text-anchor="middle" fill="#4caf50" font-weight="700" font-size="16">A</text>
  <circle cx="60" cy="175" r="5" class="node-dot"/>
  <text x="38" y="180" text-anchor="end" fill="#4caf50" font-weight="700" font-size="16">B</text>
  <circle cx="340" cy="175" r="5" class="node-dot"/>
  <text x="362" y="180" text-anchor="start" fill="#4caf50" font-weight="700" font-size="16">C</text>
  <circle cx="200" cy="320" r="5" class="node-dot"/>
  <text x="200" y="342" text-anchor="middle" fill="#4caf50" font-weight="700" font-size="16">D</text>
  <text x="200" y="8" text-anchor="middle" fill="#ffa726" font-size="13">+ U‚ÇÄ ‚àí</text>
</svg>

<div class="input-group">
  <label>R‚ÇÅ:</label><input type="number" id="calc-r1" value="100" min="1" oninput="calcAll()"><span class="unit">Œ©</span>
  <label>R‚ÇÇ:</label><input type="number" id="calc-r2" value="220" min="1" oninput="calcAll()"><span class="unit">Œ©</span>
</div>
<div class="input-group">
  <label>R‚ÇÉ:</label><input type="number" id="calc-r3" value="330" min="1" oninput="calcAll()"><span class="unit">Œ©</span>
  <label>R‚ÇÑ:</label><input type="number" id="calc-r4" value="470" min="1" oninput="calcAll()"><span class="unit">Œ©</span>
</div>
<div class="input-group">
  <label>R‚ÇÖ:</label><input type="number" id="calc-r5" value="150" min="1" oninput="calcAll()"><span class="unit">Œ©</span>
  <label>U‚ÇÄ:</label><input type="number" id="calc-u0" value="12" min="0.1" step="0.1" oninput="calcAll()"><span class="unit">V</span>
</div>

<div class="result info show" id="calc-result">
  <div class="result-grid" id="calc-result-grid"></div>
</div>

<div class="theory" style="margin-top:1rem">
  <h3>Abgleich-Check</h3>
  <div id="calc-balance"></div>
</div>

<div class="cas-box" id="calc-cas">
  <div class="cas-label">üì± ClassPad CAS:</div>
  <span id="calc-cas-text"></span>
</div>
</section>
</main>

<script>
'use strict';

// ===== NAVIGATION =====
const sections = document.querySelectorAll('section');
const navLinks = document.querySelectorAll('nav a[data-ch]');
const completed = new Set();

function goTo(ch) {
  sections.forEach((s,i) => { s.classList.toggle('active', i===ch); });
  navLinks.forEach((a,i) => { a.classList.toggle('active', i===ch); });
  document.querySelector('nav').classList.remove('open');
  window.scrollTo(0,0);
}

navLinks.forEach(a => a.addEventListener('click', e => { e.preventDefault(); goTo(+a.dataset.ch); }));

function markDone(ch) {
  completed.add(ch);
  navLinks[ch].querySelector('.ch-check').classList.add('done');
  const pct = Math.round(completed.size/6*100);
  document.getElementById('progressFill').style.width = pct+'%';
  document.getElementById('progressLabel').textContent = completed.size+' / 6 abgeschlossen';
}

function showResult(id, ok, msg) {
  const el = document.getElementById(id);
  el.className = 'result show ' + (ok ? 'ok' : 'err');
  el.innerHTML = (ok ? '‚úì ' : '‚úó ') + msg;
}

// ===== CH1: PARALLEL =====
function parCalc() {
  const r1=+document.getElementById('par-r1').value;
  const r2=+document.getElementById('par-r2').value;
  const r3=+document.getElementById('par-r3').value;
  const u=+document.getElementById('par-u').value;
  document.getElementById('par-r1-val').textContent=r1+' Œ©';
  document.getElementById('par-r2-val').textContent=r2+' Œ©';
  document.getElementById('par-r3-val').textContent=r3+' Œ©';
  document.getElementById('par-u-val').textContent=u+' V';
  document.getElementById('par-r1-label').textContent='R‚ÇÅ = '+r1+' Œ©';
  document.getElementById('par-r2-label').textContent='R‚ÇÇ = '+r2+' Œ©';
  document.getElementById('par-r3-label').textContent='R‚ÇÉ = '+r3+' Œ©';
  const rg = 1/(1/r1+1/r2+1/r3);
  const ig = u/rg;
  const i1=u/r1, i2=u/r2, i3=u/r3;
  // show flow animation
  ['par-flow1','par-flow2','par-flow3'].forEach(id => document.getElementById(id).style.opacity='.6');
  document.getElementById('par-result-grid').innerHTML = [
    item('R<sub>ges</sub>', rg.toFixed(2)+' Œ©'),
    item('I<sub>ges</sub>', (ig*1000).toFixed(1)+' mA'),
    item('I‚ÇÅ', (i1*1000).toFixed(1)+' mA'),
    item('I‚ÇÇ', (i2*1000).toFixed(1)+' mA'),
    item('I‚ÇÉ', (i3*1000).toFixed(1)+' mA'),
    item('U', u.toFixed(1)+' V'),
  ].join('');
}

function item(l,v) { return `<div class="item"><div class="lbl">${l}</div><div class="val">${v}</div></div>`; }

function parCheck() {
  const ans = +document.getElementById('par-quiz').value;
  const correct = 1/(1/150+1/300); // 100
  if(Math.abs(ans-correct)<1) { showResult('par-quiz-result',true,'Richtig! R<sub>ges</sub> = 100 Œ©'); markDone(0); }
  else showResult('par-quiz-result',false,'Falsch. Tipp: 1/R<sub>ges</sub> = 1/150 + 1/300');
}

parCalc();

// ===== CH2: MIXED =====
let mixStep = 1;
function mixChoice(step, choice) {
  if(step!==1) return;
  const ok = choice==='r2r3';
  showResult('mix-step1-result', ok, ok ? 'Richtig! R‚ÇÇ und R‚ÇÉ liegen parallel.' : 'Falsch ‚Äì schau dir an, welche Widerst√§nde die gleichen Knoten teilen.');
  if(ok) { document.getElementById('mix-step2').style.opacity='1'; mixStep=2; }
}
function mixCheck2() {
  const ans = +document.getElementById('mix-r23').value;
  const correct = 1/(1/220+1/330); // ‚âà132
  if(Math.abs(ans-correct)<1) { showResult('mix-step2-result',true,'Richtig! R‚ÇÇ‚ÇÉ ‚âà '+correct.toFixed(1)+' Œ©'); document.getElementById('mix-step3').style.opacity='1'; mixStep=3; }
  else showResult('mix-step2-result',false,'Falsch. R‚ÇÇ‚ÇÉ = 1/(1/220 + 1/330) ‚âà '+correct.toFixed(1)+' Œ©');
}
function mixCheck3() {
  const r23 = 1/(1/220+1/330);
  const correct = 100 + r23;
  const ans = +document.getElementById('mix-rges').value;
  if(Math.abs(ans-correct)<1) { showResult('mix-step3-result',true,'Richtig! R<sub>ges</sub> ‚âà '+correct.toFixed(1)+' Œ©'); markDone(1); }
  else showResult('mix-step3-result',false,'Falsch. R<sub>ges</sub> = R‚ÇÅ + R‚ÇÇ‚ÇÉ = 100 + '+r23.toFixed(1)+' ‚âà '+correct.toFixed(1)+' Œ©');
}

// ===== CH3: WHEATSTONE QUIZ =====
function wheatQuiz(btn, ok) {
  showResult('wheat-quiz-result', ok, ok ? 'Richtig! R‚ÇÅ¬∑R‚ÇÑ = R‚ÇÇ¬∑R‚ÇÉ ist die Abgleichbedingung.' : 'Falsch ‚Äì es ist ein Produkt, keine Summe!');
  if(ok) markDone(2);
}

// ===== CH4: KIRCHHOFF =====
let currentNode = 'A';
const nodeEqs = {
  A: {hint:'Am Knoten A: Der Gesamtstrom teilt sich in I‚ÇÅ und I‚ÇÇ.', valid:['I1+I2','I0']},
  B: {hint:'Am Knoten B: I‚ÇÅ kommt an, I‚ÇÉ und I‚ÇÖ gehen ab.', check: coeffs => coeffs[0]===1 && coeffs[2]===-1 && coeffs[4]===-1 && coeffs[1]===0 && coeffs[3]===0},
  C: {hint:'Am Knoten C: I‚ÇÇ und I‚ÇÖ kommen an, I‚ÇÑ geht ab.', check: coeffs => coeffs[1]===1 && coeffs[4]===1 && coeffs[3]===-1 && coeffs[0]===0 && coeffs[2]===0},
  D: {hint:'Am Knoten D: I‚ÇÉ und I‚ÇÑ kommen an, der Strom flie√üt zur√ºck zur Quelle.', valid:['I3+I4','I0']},
};

function selNode(el, node) {
  document.querySelectorAll('.node-sel').forEach(s=>s.classList.remove('active'));
  el.classList.add('active');
  currentNode = node;
  document.getElementById('node-hint').innerHTML = nodeEqs[node].hint;
}
selNode(document.getElementById('node-A'),'A');

function parseEqCoeffs(str) {
  // Parse simple equation like "I1-I3-I5=0" into coefficients [I1,I2,I3,I4,I5,rhs]
  str = str.replace(/\s/g,'').toUpperCase();
  const parts = str.split('=');
  if(parts.length!==2) return null;
  const lhs = parts[0], rhs = parseFloat(parts[1])||0;
  const coeffs = [0,0,0,0,0];
  const regex = /([+-]?)(\d*)I([1-5])/g;
  let m;
  while((m=regex.exec(lhs))!==null) {
    const sign = m[1]==='-' ? -1 : 1;
    const coeff = m[2] ? parseInt(m[2]) : 1;
    coeffs[parseInt(m[3])-1] = sign*coeff;
  }
  return {coeffs, rhs};
}

function checkNodeEq() {
  const input = document.getElementById('node-eq').value.trim();
  if(!input) return;
  const parsed = parseEqCoeffs(input);
  if(!parsed) { showResult('node-eq-result',false,'Konnte die Gleichung nicht parsen. Format: I1-I3-I5=0'); return; }
  // Check based on current node
  let ok = false;
  if(currentNode==='B') { ok = parsed.coeffs[0]===1 && parsed.coeffs[2]===-1 && parsed.coeffs[4]===-1 && parsed.coeffs[1]===0 && parsed.coeffs[3]===0 && parsed.rhs===0; }
  else if(currentNode==='C') {
    // I2+I5-I4=0 or I2-I4+I5=0
    ok = parsed.coeffs[1]===1 && parsed.coeffs[3]===-1 && parsed.coeffs[4]===1 && parsed.coeffs[0]===0 && parsed.coeffs[2]===0 && parsed.rhs===0;
    // also accept I4=I2+I5 ‚Üí rearranged: -I2+I4-I5=0
    if(!ok) ok = parsed.coeffs[1]===-1 && parsed.coeffs[3]===1 && parsed.coeffs[4]===-1 && parsed.coeffs[0]===0 && parsed.coeffs[2]===0 && parsed.rhs===0;
  }
  else if(currentNode==='A') {
    // I1+I2 on left ‚Üí not easily checkable without I0, just accept common forms
    showResult('node-eq-result',true,'F√ºr Knoten A verwenden wir I‚ÇÄ = I‚ÇÅ + I‚ÇÇ. Da I‚ÇÄ keine unserer 5 Unbekannten ist, nutzen wir lieber Knoten B und C!');
    return;
  }
  else if(currentNode==='D') {
    showResult('node-eq-result',true,'F√ºr Knoten D: I‚ÇÉ + I‚ÇÑ = I‚ÇÄ. Auch hier kommt I‚ÇÄ vor. Besser: Knoten B und C verwenden!');
    return;
  }
  showResult('node-eq-result', ok, ok ? 'Richtig! ‚úì' : 'Nicht ganz. Tipp: '+nodeEqs[currentNode].hint);
}

let currentMesh = 'M1';
const meshInfo = {
  M1: {hint:'Masche 1 (A‚ÜíB‚ÜíD‚ÜíA, im Uhrzeigersinn): U‚ÇÄ ‚àí R‚ÇÅ¬∑I‚ÇÅ ‚àí R‚ÇÉ¬∑I‚ÇÉ = 0'},
  M2: {hint:'Masche 2 (A‚ÜíC‚ÜíD‚ÜíA, im Uhrzeigersinn): U‚ÇÄ ‚àí R‚ÇÇ¬∑I‚ÇÇ ‚àí R‚ÇÑ¬∑I‚ÇÑ = 0'},
  M3: {hint:'Masche 3 (B‚ÜíC‚ÜíD‚ÜíB): R‚ÇÖ¬∑I‚ÇÖ + R‚ÇÑ¬∑I‚ÇÑ ‚àí R‚ÇÉ¬∑I‚ÇÉ = 0'},
};

function selMesh(el, mesh) {
  document.querySelectorAll('.mesh-sel').forEach(s=>s.classList.remove('active'));
  el.classList.add('active');
  currentMesh = mesh;
  document.getElementById('mesh-hint').innerHTML = meshInfo[mesh].hint;
}
selMesh(document.getElementById('mesh-M1'),'M1');

function checkMeshEq() {
  const input = document.getElementById('mesh-eq').value.trim();
  if(!input) return;
  // Simple validation: just show the correct answer
  const correct = meshInfo[currentMesh].hint;
  showResult('mesh-eq-result', true, 'Korrekte Form: ' + correct + '<br>Vergleiche mit deiner Eingabe!');
}

function signQuiz(btn, ok) {
  // The question asks about the sign of R5*I5 in mesh M3 going B‚ÜíC
  // I5 goes B‚ÜíC, mesh goes B‚ÜíC ‚Üí same direction ‚Üí voltage DROP ‚Üí in ‚àëU=0 it's ‚àíR5¬∑I5
  // Wait, let me reconsider. If going B‚ÜíC and current is B‚ÜíC, voltage drops: U_R5 = -R5*I5 in KVL
  // Actually the convention: going WITH current direction = voltage drop = subtract
  // So ‚àíR‚ÇÖ¬∑I‚ÇÖ is correct in ‚àëU=0
  showResult('sign-quiz-result', ok, ok ? 'Richtig! In der Maschengleichung (‚àëU=0) wird der Spannungsabfall subtrahiert, wenn Umlauf- und Stromrichtung √ºbereinstimmen.' : 'Nicht ganz ‚Äì denk daran: Umlaufrichtung = Stromrichtung ‚Üí Spannungsabfall ‚Üí negatives Vorzeichen in ‚àëU=0.');
  document.getElementById('sign-explain').style.display = ok ? 'block' : 'none';
  if(ok) markDone(3);
}

// ===== CH5: EQUATION SYSTEM =====
function getEqMatrix() {
  const A=[], b=[];
  for(let i=0;i<5;i++) {
    A.push([]);
    for(let j=0;j<5;j++) A[i].push(parseFloat(document.getElementById('eq'+i+j).value)||0);
    b.push(parseFloat(document.getElementById('eq'+i+5).value)||0);
  }
  return {A,b};
}

// Correct matrix for default values
const correctA = [[1,0,-1,0,-1],[0,1,0,-1,1],[100,0,330,0,0],[0,220,0,470,0],[0,0,-330,470,150]];
const correctB = [0,0,12,12,0];

function checkEqSystem() {
  const {A,b} = getEqMatrix();
  let allOk = true;
  for(let i=0;i<5;i++) {
    for(let j=0;j<5;j++) {
      const el = document.getElementById('eq'+i+j);
      const ok = A[i][j]===correctA[i][j];
      el.className = ok ? 'ok' : 'err';
      if(!ok) allOk=false;
    }
    const el = document.getElementById('eq'+i+5);
    const ok = b[i]===correctB[i];
    el.className = ok ? 'ok' : 'err';
    if(!ok) allOk=false;
  }
  showResult('eq-check-result', allOk, allOk ? 'Alle Koeffizienten korrekt!' : 'Einige Koeffizienten stimmen nicht (rot markiert).');
  if(allOk) markDone(4);
}

function gaussSolve(A, b) {
  const n = A.length;
  // Augmented matrix
  const M = A.map((row,i)=>[...row, b[i]]);
  for(let col=0;col<n;col++) {
    // Pivot
    let maxRow=col;
    for(let row=col+1;row<n;row++) if(Math.abs(M[row][col])>Math.abs(M[maxRow][col])) maxRow=row;
    [M[col],M[maxRow]]=[M[maxRow],M[col]];
    if(Math.abs(M[col][col])<1e-12) return null;
    for(let row=col+1;row<n;row++) {
      const f=M[row][col]/M[col][col];
      for(let j=col;j<=n;j++) M[row][j]-=f*M[col][j];
    }
  }
  // Back substitution
  const x=new Array(n);
  for(let i=n-1;i>=0;i--) {
    x[i]=M[i][n];
    for(let j=i+1;j<n;j++) x[i]-=M[i][j]*x[j];
    x[i]/=M[i][i];
  }
  return x;
}

function solveSystem() {
  const {A,b} = getEqMatrix();
  const x = gaussSolve(A.map(r=>[...r]), [...b]);
  if(!x) { showResult('eq-solve-result',false,'Gleichungssystem ist nicht l√∂sbar (singul√§re Matrix).'); return; }
  const [I1,I2,I3,I4,I5] = x;
  const I0 = I1+I2;
  const U0 = b[2]||12; // from mesh 1
  const Rges = U0/I0;
  const Ubc = I5 * (parseFloat(document.getElementById('eq44').value)||150); // R5*I5

  let html = '<strong>L√∂sung:</strong><br><div class="result-grid">';
  html += item('I‚ÇÅ', (I1*1000).toFixed(3)+' mA');
  html += item('I‚ÇÇ', (I2*1000).toFixed(3)+' mA');
  html += item('I‚ÇÉ', (I3*1000).toFixed(3)+' mA');
  html += item('I‚ÇÑ', (I4*1000).toFixed(3)+' mA');
  html += item('I‚ÇÖ', (I5*1000).toFixed(3)+' mA');
  html += item('I‚ÇÄ = I‚ÇÅ+I‚ÇÇ', (I0*1000).toFixed(3)+' mA');
  html += item('R<sub>ges</sub> = U‚ÇÄ/I‚ÇÄ', Rges.toFixed(2)+' Œ©');
  html += item('U<sub>BC</sub> = R‚ÇÖ¬∑I‚ÇÖ', (Ubc*1000).toFixed(3)+' mV');
  html += '</div>';
  const el = document.getElementById('eq-solve-result');
  el.className = 'result show info';
  el.innerHTML = html;
}

function showCAS() {
  const box = document.getElementById('cas-box');
  box.style.display = box.style.display==='none' ? 'block' : 'none';
}

// ===== CH6: FREE CALCULATOR =====
function solveWheatstone(R1,R2,R3,R4,R5,U0) {
  const A = [[1,0,-1,0,-1],[0,1,0,-1,1],[R1,0,R3,0,0],[0,R2,0,R4,0],[0,0,-R3,R4,R5]];
  const b = [0,0,U0,U0,0];
  return gaussSolve(A,b);
}

function calcAll() {
  const R1=+document.getElementById('calc-r1').value||100;
  const R2=+document.getElementById('calc-r2').value||220;
  const R3=+document.getElementById('calc-r3').value||330;
  const R4=+document.getElementById('calc-r4').value||470;
  const R5=+document.getElementById('calc-r5').value||150;
  const U0=+document.getElementById('calc-u0').value||12;

  // Update SVG labels
  document.getElementById('calc-r1-label').textContent = 'R‚ÇÅ='+R1+'Œ©';
  document.getElementById('calc-r2-label').textContent = 'R‚ÇÇ='+R2+'Œ©';
  document.getElementById('calc-r3-label').textContent = 'R‚ÇÉ='+R3+'Œ©';
  document.getElementById('calc-r4-label').textContent = 'R‚ÇÑ='+R4+'Œ©';
  document.getElementById('calc-r5-label').textContent = 'R‚ÇÖ='+R5+'Œ©';

  const x = solveWheatstone(R1,R2,R3,R4,R5,U0);
  if(!x) { document.getElementById('calc-result-grid').innerHTML='<em>Nicht l√∂sbar</em>'; return; }
  const [I1,I2,I3,I4,I5] = x;
  const I0=I1+I2;
  const Rges=U0/I0;
  const Ubc=R5*I5;

  // SVG current labels
  const fmt = v => (v*1000).toFixed(2)+' mA';
  document.getElementById('calc-i1-svg').textContent = 'I‚ÇÅ='+fmt(I1);
  document.getElementById('calc-i2-svg').textContent = 'I‚ÇÇ='+fmt(I2);
  document.getElementById('calc-i3-svg').textContent = 'I‚ÇÉ='+fmt(I3);
  document.getElementById('calc-i4-svg').textContent = 'I‚ÇÑ='+fmt(I4);
  document.getElementById('calc-i5-svg').textContent = 'I‚ÇÖ='+fmt(I5);

  let html = '';
  html += item('I‚ÇÅ', fmt(I1));
  html += item('I‚ÇÇ', fmt(I2));
  html += item('I‚ÇÉ', fmt(I3));
  html += item('I‚ÇÑ', fmt(I4));
  html += item('I‚ÇÖ', fmt(I5));
  html += item('I‚ÇÄ', fmt(I0));
  html += item('R<sub>ges</sub>', Rges.toFixed(2)+' Œ©');
  html += item('U<sub>BC</sub>', (Ubc*1000).toFixed(2)+' mV');
  html += item('U<sub>R1</sub>', (R1*I1*1000).toFixed(2)+' mV');
  html += item('U<sub>R2</sub>', (R2*I2*1000).toFixed(2)+' mV');
  html += item('U<sub>R3</sub>', (R3*I3*1000).toFixed(2)+' mV');
  html += item('U<sub>R4</sub>', (R4*I4*1000).toFixed(2)+' mV');
  document.getElementById('calc-result-grid').innerHTML = html;

  // Balance check
  const prod1 = R1*R4, prod2 = R2*R3;
  const balanced = Math.abs(prod1-prod2)<0.01;
  document.getElementById('calc-balance').innerHTML = `R‚ÇÅ¬∑R‚ÇÑ = ${prod1} | R‚ÇÇ¬∑R‚ÇÉ = ${prod2} ‚Üí ${balanced ? '<strong style="color:var(--ok)">Abgeglichen! I‚ÇÖ‚âà0</strong>' : '<strong style="color:var(--warn)">Nicht abgeglichen (I‚ÇÖ‚â†0)</strong>'}`;

  // CAS text
  document.getElementById('calc-cas-text').textContent =
`solve({
  I1-I3-I5=0,
  I2-I4+I5=0,
  ${R1}*I1+${R3}*I3=${U0},
  ${R2}*I2+${R4}*I4=${U0},
  -${R3}*I3+${R4}*I4+${R5}*I5=0
},{I1,I2,I3,I4,I5})`;

  markDone(5);
}

calcAll();

// Init hints
document.getElementById('node-hint').innerHTML = nodeEqs['A'].hint;
document.getElementById('mesh-hint').innerHTML = meshInfo['M1'].hint;
</script>
</body>
</html>
